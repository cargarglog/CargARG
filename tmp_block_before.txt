    // Gestiona el resultado de signInWithRedirect para Google (si lo hay) y autoprov del perfil
    useEffect(() => {
        (async () => {
            try {
                redirectPendingRef.current = true;
                const result = await authFirebase.getRedirectResult(auth);
                if (result?.user) {
                    const firebaseUser = result.user;
                    const userDocRef = firestore.doc(db, 'users', firebaseUser.uid);
                    // Idempotente: no sobrescribe si ya existe
                    await firestore.setDoc(userDocRef, {
                        uid: firebaseUser.uid,
                        email: (firebaseUser.email || '').toLowerCase().trim(),
                        role: UserRole.DRIVER,
                        companyName: null,
                        perfilEstado: 'pending_attempt1', verificationStatus: 'pending',
                        plan: 'free',
                        createdAt: firestore.serverTimestamp(),
                    }, { merge: true });
                }
            } catch (e) {
                console.warn('[Google Redirect] Error post-redirect:', e);
            } finally {
                // Limpia bandera si se us?
                sessionStorage.removeItem('cargarg:doRedirectResult');
                redirectPendingRef.current = false;
            }
        })();
    }, []);
