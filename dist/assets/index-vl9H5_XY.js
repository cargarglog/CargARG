const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChatBot-DQewkl5q.js","assets/vendor-CuDMUxSy.js","assets/firebase-v84oFIZ0.js","assets/genai-BuPwoIhQ.js"])))=>i.map(i=>d[i]);
import{r,j as e,R as re,a as Fe}from"./vendor-CuDMUxSy.js";import{T as ne,G as Oe}from"./genai-BuPwoIhQ.js";import{i as $e,g as Ue,s as ze,b as Be,u as Ge,a as je,c as qe,d as He,e as Ye,q as ae,f as K,w as ue,h as Z,o as he,l as ve,r as We,j as Ke,k as X,m as H,n as J,p as le,t as xe,v as Qe,x as Je,y as Xe,z as Ze,G as et,A as we,B as tt,C as Ne,D as at,E as Se,F as st,H as rt}from"./firebase-v84oFIZ0.js";const nt=(function(){const a=typeof document<"u"&&document.createElement("link").relList;return a&&a.supports&&a.supports("modulepreload")?"modulepreload":"preload"})(),it=function(t){return"/"+t},Ce={},ee=function(a,n,s){let i=Promise.resolve();if(n&&n.length>0){let o=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};document.getElementsByTagName("link");const j=document.querySelector("meta[property=csp-nonce]"),w=j?.nonce||j?.getAttribute("nonce");i=o(n.map(m=>{if(m=it(m),m in Ce)return;Ce[m]=!0;const y=m.endsWith(".css"),S=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${S}`))return;const l=document.createElement("link");if(l.rel=y?"stylesheet":nt,y||(l.as="script"),l.crossOrigin="",l.href=m,w&&l.setAttribute("nonce",w),document.head.appendChild(l),y)return new Promise((N,R)=>{l.addEventListener("load",N),l.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${m}`)))})}))}function d(o){const j=new Event("vite:preloadError",{cancelable:!0});if(j.payload=o,window.dispatchEvent(j),!j.defaultPrevented)throw o}return i.then(o=>{for(const j of o||[])j.status==="rejected"&&d(j.reason);return a().catch(d)})};var I=(t=>(t.DRIVER="driver",t.COMPANY="company",t.STAFF="staff",t))(I||{}),_=(t=>(t.AVAILABLE="available",t.IN_PROGRESS="in_progress",t.COMPLETED="completed",t))(_||{});const ot=({user:t,onNavigate:a,onLogout:n,isOnline:s,onCancelSubscription:i})=>{const[d,o]=r.useState(!1),j=r.useRef(null),[w,m]=r.useState(!1),[y,S]=r.useState(!1),l=r.useRef(null),[N,R]=r.useState(!1);r.useEffect(()=>{const c=p=>{j.current&&!j.current.contains(p.target)&&o(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[j]),r.useEffect(()=>{const c=L=>{L.preventDefault(),l.current=L,m(!0)},p=()=>{m(!1),l.current=null};window.addEventListener("beforeinstallprompt",c),window.addEventListener("appinstalled",p);const C=()=>{const L=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches,g=window.navigator?.standalone===!0;S(!!(L||g))};return C(),document.addEventListener("visibilitychange",C),()=>{window.removeEventListener("beforeinstallprompt",c),window.removeEventListener("appinstalled",p),document.removeEventListener("visibilitychange",C)}},[]);const x=async()=>{const c=l.current;if(c){c.prompt();try{await c.userChoice}finally{m(!1),l.current=null}}else R(!0)};return e.jsxs("header",{className:`bg-charcoal-900 shadow-md sticky z-50 transition-all duration-300 ${s?"top-0":"top-[40px]"}`,children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-4 flex justify-between items-center",children:[e.jsxs("div",{className:"cursor-pointer flex items-center gap-2",onClick:()=>a(t?"dashboard":"landing"),children:[e.jsx("img",{src:"/assets/icons/icon-192.png",alt:"CargARG",className:"h-8 w-8 rounded-md",loading:"lazy",decoding:"async"}),e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:[e.jsx("span",{className:"text-white",children:"Carg"}),e.jsx("span",{className:"text-brand-500",children:"ARG"})]})]}),e.jsxs("nav",{className:"flex items-center gap-3",children:[!y&&e.jsxs("button",{onClick:x,className:"bg-brand-600 text-white font-bold py-2 px-3 sm:px-4 rounded-md hover:bg-brand-500 transition-all flex items-center","aria-label":"Instalar app",title:"Instalar app",children:[e.jsxs("svg",{"aria-hidden":"true",viewBox:"0 0 24 24",className:"h-5 w-5",fill:"currentColor",children:[e.jsx("path",{d:"M5 20h14a2 2 0 0 0 2-2v-2h-2v2H5v-2H3v2a2 2 0 0 0 2 2z"}),e.jsx("path",{d:"M11 4v8.586L8.707 10.293 7.293 11.707 12 16.414l4.707-4.707-1.414-1.414L13 12.586V4h-2z"})]}),e.jsx("span",{className:"hidden sm:inline ml-2",children:"Instalar"})]}),t?e.jsxs("div",{className:"relative",ref:j,children:[e.jsxs("button",{onClick:()=>o(!d),className:"flex items-center gap-2 bg-charcoal-800/50 hover:bg-charcoal-700/50 p-2 rounded-full transition-colors",children:[e.jsx("span",{className:"font-semibold text-sm text-gray-200 hidden sm:inline",children:t.email}),e.jsx("i",{className:"fas fa-user-circle text-2xl text-brand-400"}),e.jsx("i",{className:`fas fa-chevron-down text-xs text-gray-400 transition-transform ${d?"rotate-180":""}`})]}),d&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-gray-800 rounded-md shadow-lg py-1 z-50 border border-gray-700",children:[t.role===I.STAFF?e.jsx("a",{onClick:()=>{a("staffDashboard"),o(!1)},className:"block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 cursor-pointer",children:"Panel de Staff"}):e.jsx("a",{onClick:()=>{a("dashboard"),o(!1)},className:"block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 cursor-pointer",children:"Dashboard"}),t.role===I.COMPANY&&e.jsx("a",{onClick:()=>{a("postLoad"),o(!1)},className:"block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 cursor-pointer",children:"Publicar Carga"}),t.role===I.DRIVER&&e.jsx("a",{onClick:()=>{a("dashboard"),o(!1)},className:"block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 cursor-pointer",children:"Mis Viajes"}),e.jsx("a",{onClick:()=>{a("plans"),o(!1)},className:"block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 cursor-pointer",children:"Planes"}),t.plan!=="free"&&e.jsx("a",{onClick:()=>{i&&i(),o(!1)},className:"block px-4 py-2 text-sm text-red-300 hover:bg-gray-700 cursor-pointer",children:"Cancelar Suscripción"}),e.jsx("div",{className:"border-t border-gray-700 my-1"}),e.jsx("a",{onClick:()=>{n(),o(!1)},className:"block px-4 py-2 text-sm text-red-400 hover:bg-gray-700 cursor-pointer",children:"Cerrar Sesión"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("button",{onClick:()=>a("login"),className:"bg-brand-600 text-white font-bold py-2 px-3 sm:px-6 rounded-md hover:bg-brand-500 transition-all duration-300 transform hover:scale-105 flex items-center","aria-label":"Iniciar sesión",title:"Iniciar sesión",children:[e.jsxs("svg",{"aria-hidden":"true",viewBox:"0 0 24 24",className:"h-5 w-5",fill:"currentColor",children:[e.jsx("path",{d:"M10 17l5-5-5-5v3H3v4h7v3z"}),e.jsx("path",{d:"M20 3h-8v2h8v14h-8v2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"})]}),e.jsx("span",{className:"hidden sm:inline ml-2",children:"Iniciar Sesión"})]})})]})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-[1000]",onClick:()=>R(!1),children:e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4 max-w-sm mx-4",onClick:c=>c.stopPropagation(),children:[e.jsx("h3",{className:"text-white font-bold mb-2",children:"Instalar CargARG"}),e.jsx("p",{className:"text-gray-300 text-sm mb-2",children:"Para instalar la app:"}),e.jsxs("ul",{className:"text-gray-400 text-sm list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"En Android (Chrome): menú ⋮ → “Añadir a pantalla principal”."}),e.jsx("li",{children:"En iOS (Safari): botón Compartir → “Añadir a pantalla de inicio”."})]}),e.jsx("button",{className:"mt-4 bg-brand-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-brand-500",onClick:()=>R(!1),children:"Entendido"})]})})]})},ge="gemini-2.5-flash";function fe(){const t="AIzaSyBkr9Gk2w5b3LrnRz4DDiIEfC-qxXEhz0w";return new Oe({apiKey:t})}async function lt(t,a,n,s){const i="Responde en español como Asistente de CargARG.",d=`Origen: ${a.startLocation.address}
Destino: ${a.endLocation.address}`,o=`Rol: ${n.role==="driver"?"Conductor":"Empresa"}
Ubicación: ${s?`${s.lat}, ${s.lng}`:"No disponible"}`,j=`Contexto:
${d}
${o}
Pregunta: "${t}"`;try{return{text:(await fe().models.generateContent({model:ge,contents:j,config:{systemInstruction:i}})).text}}catch{return{text:"No pude responder ahora. Intenta nuevamente."}}}async function ct(t,a){const n='Devuelve solo JSON {"ready": boolean, "feedback": "string"}.';let s="";switch(a){case"dniFront":s=`${n} Verifica nitidez/iluminación y que sea el FRENTE del documento; completo y centrado.`;break;case"dniBack":s=`${n} Verifica DORSO del DNI (QR/barras, trámite, microtexto, zonas de seguridad); acepta si hay indicios claros.`;break;case"licenseFront":s=`${n} Verifica FRENTE de licencia (texto "Licencia", categoría, foto, vigencia); horizontal y completa.`;break;case"licenseBack":s=`${n} Verifica DORSO de licencia (QR/códigos, microtexto, zonas de seguridad); horizontal y completo.`;break;case"selfie":s=`${n} Selfie clara de un solo rostro, mirando al frente y bien iluminada.`;break;default:s=n}const i={inlineData:{mimeType:"image/jpeg",data:t}};try{const o=await fe().models.generateContent({model:ge,contents:[{parts:[i,{text:s}]}],config:{responseMimeType:"application/json",responseSchema:{type:ne.OBJECT,properties:{ready:{type:ne.BOOLEAN},feedback:{type:ne.STRING}}}}});return JSON.parse(o.text.trim())}catch{return{ready:!1,feedback:"Error de análisis. Intenta de nuevo."}}}async function dt(t,a,n,s){const i='Valida consistencia general de frente/dorso y selfie. Responde solo JSON {"success": boolean, "reason": "string"}.';try{const o=await fe().models.generateContent({model:ge,contents:[{parts:[{inlineData:{mimeType:"image/jpeg",data:t}},{inlineData:{mimeType:"image/jpeg",data:a}},{inlineData:{mimeType:"image/jpeg",data:n}},{text:i}]}],config:{responseMimeType:"application/json",responseSchema:{type:ne.OBJECT,properties:{success:{type:ne.BOOLEAN},reason:{type:ne.STRING}},required:["success","reason"]}}});return JSON.parse(o.text.trim())}catch{return{success:!1,reason:"Error al analizar los documentos."}}}async function Ae(t,a){try{const s=await fe().models.generateContent({model:ge,contents:`Distancia en km entre (${t.lat}, ${t.lng}) y "${a}". Solo número.`}),i=parseFloat(s.text.trim().replace(",","."));return isNaN(i)?null:i}catch{return null}}const zt=Object.freeze(Object.defineProperty({__proto__:null,analyzeImageForVerification:ct,checkDocumentConsistency:dt,getChatResponse:lt,getDrivingDistance:Ae},Symbol.toStringTag,{value:"Module"})),mt=["semirremolque","bitren","chasis acoplado","chasis","balancin","road train","furgon","sider","cisterna","tolva","portacontenedor","otro"],pt=(t,a="ARS")=>new Intl.NumberFormat(a==="ARS"?"es-AR":a==="USD"?"en-US":"pt-BR",{style:"currency",currency:a,minimumFractionDigits:0}).format(t),ke=({rating:t})=>e.jsx("div",{className:"flex items-center justify-start",children:[...Array(5)].map((a,n)=>e.jsx("i",{className:`fas fa-star text-sm ${n<t?"text-yellow-400":"text-gray-600"}`},n))}),te=({load:t,onSelect:a,userRole:n,distance:s})=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden cursor-pointer",onClick:()=>a(t),children:e.jsxs("div",{className:"p-5 border-l-4 border-transparent hover:border-[#F57921]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400",children:["Carga #",t.id.substring(0,6)]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["por ",t.company]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-semibold text-green-400",children:pt(t.price,t.currency||"ARS")}),t.status===_.COMPLETED&&e.jsx("p",{className:"text-xs font-bold text-green-300 bg-green-900/50 px-2 py-1 rounded-full inline-block mt-1",children:"COMPLETADO"}),t.status===_.IN_PROGRESS&&e.jsx("p",{className:"text-xs font-bold text-blue-300 bg-blue-900/50 px-2 py-1 rounded-full inline-block mt-1",children:"EN CURSO"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsxs("div",{className:"flex flex-col items-center mr-4",children:[e.jsx("i",{className:"fas fa-map-marker-alt text-gray-500"}),e.jsx("div",{className:"w-px h-12 bg-gray-600 my-1"}),e.jsx("i",{className:"fas fa-flag-checkered text-[#F57921]"})]}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-200",children:t.startLocation.address}),n===I.DRIVER&&t.status===_.AVAILABLE&&e.jsxs(e.Fragment,{children:[s===void 0&&e.jsx("p",{className:"text-xs text-gray-500 animate-pulse mt-1",children:"Calculando distancia..."}),s!=null&&e.jsxs("p",{className:"text-xs text-blue-400 font-semibold mt-1",children:[e.jsx("i",{className:"fas fa-route mr-1"}),Math.round(s)," km de tu ubicación"]})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"font-semibold text-gray-200",children:t.endLocation.address})})]}),t.status!==_.COMPLETED&&e.jsx("div",{className:"self-end",children:e.jsx("button",{className:"bg-brand-600 text-white font-bold py-2 px-4 rounded-md hover:bg-brand-500 transition-colors",children:"Detalles"})})]}),t.status===_.COMPLETED&&e.jsxs("div",{className:"border-t border-gray-700 mt-4 pt-3 text-xs flex justify-around",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-gray-400",children:"Tu Calificación"}),e.jsx(ke,{rating:n===I.DRIVER?t.companyRating??0:t.driverRating??0})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-gray-400",children:"Calificación Recibida"}),e.jsx(ke,{rating:n===I.DRIVER?t.driverRating??0:t.companyRating??0})]})]})]})}),Ee=(t,a)=>{const s=(a.lat-t.lat)*Math.PI/180,i=(a.lng-t.lng)*Math.PI/180,d=Math.sin(s/2)*Math.sin(s/2)+Math.cos(t.lat*Math.PI/180)*Math.cos(a.lat*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))},ut=t=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",minimumFractionDigits:0}).format(t),xt=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}],gt=({user:t,availableLoads:a,userLocation:n,onSelectLoad:s})=>{const i=r.useRef(null),[d,o]=r.useState(!0);return r.useEffect(()=>{(async()=>{if(!(!n||!i.current))try{const{Map:w}=await window.google.maps.importLibrary("maps"),{Marker:m,InfoWindow:y,Circle:S}=await window.google.maps.importLibrary("marker"),l=new w(i.current,{center:n,zoom:8,disableDefaultUI:!1,mapTypeControl:!1,streetViewControl:!1,styles:xt});new m({position:n,map:l,title:"Tu ubicación",icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#4285F4",fillOpacity:1,strokeWeight:2,strokeColor:"#fff"}});const N=new y({content:"",backgroundColor:"#2d3748"});a.forEach(x=>{const c=new m({position:x.startLocation,map:l,title:`${x.startLocation.address} -> ${x.endLocation.address}`,icon:"https://maps.google.com/mapfiles/ms/icons/truck.png"});c.addListener("click",()=>{const p=`
                            <div class="p-2 text-gray-200">
                                <h3 class="font-bold text-lg text-blue-400">${x.startLocation.address} a ${x.endLocation.address}</h3>
                                <p class="text-gray-400">${x.cargoDetails}</p>
                                <p class="font-semibold text-green-400 text-md mt-2">${ut(x.price)}</p>
                                <button id="info-window-btn-${x.id}" class="mt-2 bg-[#F57921] text-white font-bold py-1 px-3 rounded-md text-sm">Ver Detalles</button>
                            </div>`;N.setContent(p),N.open(l,c),window.google.maps.event.addListenerOnce(N,"domready",()=>{const C=document.getElementById(`info-window-btn-${x.id}`);C&&C.addEventListener("click",()=>s(x))})})});const R=t.plan==="silver"||t.plan==="gold"?250:150;new S({strokeColor:"#00529B",strokeOpacity:.7,strokeWeight:2,fillColor:"#00529B",fillOpacity:.1,map:l,center:n,radius:R*1e3}),o(!1)}catch{o(!1)}})()},[n,a,s,t.plan]),d?e.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg shadow-sm h-[60vh] flex items-center justify-center",children:"Inicializando mapas..."}):e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:e.jsx("div",{ref:i,style:{width:"100%",height:"60vh"}})})},Re=({user:t,allUsers:a,loads:n,onSelectLoad:s,onNavigate:i,userLocation:d})=>{if(t.role===I.COMPANY){const f=n.filter(h=>h.companyId===t.id&&h.status===_.AVAILABLE),D=n.filter(h=>h.companyId===t.id&&h.status===_.IN_PROGRESS),O=n.filter(h=>h.companyId===t.id&&h.status===_.COMPLETED),P=t.perfilEstado==="validada";return e.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-100",children:["Panel de ",t.companyName]}),e.jsxs("button",{onClick:()=>i("postLoad"),disabled:!P,title:P?"Publicar una nueva carga":"Debes verificar tu identidad para publicar cargas",className:`font-bold py-2 px-4 rounded-md transition-all transform ${P?"bg-[#F57921] text-white hover:bg-opacity-90 hover:scale-105":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:[e.jsx("i",{className:"fas fa-plus mr-2"}),P?"Publicar Carga":"Verificación Requerida"]})]}),e.jsx("h3",{className:"text-xl font-bold text-gray-300 mb-4 mt-8",children:"Cargas Activas"}),e.jsx("div",{className:"space-y-4",children:D.length>0?D.map(h=>e.jsx(te,{load:h,onSelect:s,userRole:t.role},h.id)):e.jsx("p",{className:"text-center text-gray-400 bg-gray-800 p-6 rounded-lg shadow-sm",children:"No hay cargas en curso."})}),e.jsx("h3",{className:"text-xl font-bold text-gray-300 mb-4 mt-8",children:"Cargas Disponibles"}),e.jsx("div",{className:"space-y-4",children:f.length>0?f.map(h=>e.jsx(te,{load:h,onSelect:s,userRole:t.role},h.id)):e.jsx("p",{className:"text-center text-gray-400 bg-gray-800 p-6 rounded-lg shadow-sm",children:"No tienes cargas disponibles publicadas."})}),e.jsx("h3",{className:"text-xl font-bold text-gray-300 mb-4 mt-8",children:"Historial de Cargas"}),e.jsx("div",{className:"space-y-4",children:O.length>0?O.map(h=>e.jsx(te,{load:h,onSelect:s,userRole:t.role},h.id)):e.jsx("p",{className:"text-center text-gray-400 bg-gray-800 p-6 rounded-lg shadow-sm",children:"No hay cargas completadas."})})]})}const[o,j]=r.useState("available"),[w,m]=r.useState("list"),[y,S]=r.useState("default"),[l,N]=r.useState("all"),[R,x]=r.useState("all"),[c,p]=r.useState(new Map),[C,L]=r.useState(!0),g=r.useMemo(()=>n.filter(f=>f.status===_.AVAILABLE),[n]),b=r.useMemo(()=>n.filter(f=>f.driverId===t.id&&f.status===_.IN_PROGRESS),[n,t.id]),G=r.useMemo(()=>n.filter(f=>f.driverId===t.id&&f.status===_.COMPLETED),[n,t.id]);r.useEffect(()=>{if(!d||t.role!==I.DRIVER){L(!1);return}(async()=>{L(!0),p(new Map);const O=g.filter(P=>{if(!d)return!1;const h=t.plan==="free"?150:250;return Ee(d,P.startLocation)<=h});for(const P of O)Ae(d,P.startLocation.address).then(h=>{p($=>new Map($).set(P.id,h))}).catch(h=>{p($=>new Map($).set(P.id,null))});L(!1)})()},[g,d,t.role,t.plan]);const B=r.useMemo(()=>{const f=h=>h==="gold"?2:h==="silver"?1:0,D=new Map(a.map(h=>[h.id,h]));let O=[...g].sort((h,$)=>{const W=f(D.get(h.companyId)?.plan||"free");return f(D.get($.companyId)?.plan||"free")-W});if(d){const h=t.plan==="free"?150:250;O=O.filter($=>Ee(d,$.startLocation)<=h)}let P=O;if(t.plan!=="free"&&(l!=="all"&&(P=P.filter(h=>h.requiredTruckType?.includes(l)||!h.requiredTruckType)),R!=="all")){const[h,$]=R.split("-").map(Number);P=P.filter(W=>W.price>=h&&($?W.price<=$:!0))}switch(y){case"price_asc":return[...P].sort((h,$)=>h.price-$.price);case"price_desc":return[...P].sort((h,$)=>$.price-h.price);default:return P}},[g,a,y,l,R,t.plan,d]),E=({tabName:f,icon:D,label:O})=>e.jsxs("button",{onClick:()=>j(f),className:`flex flex-col items-center justify-center w-full pt-2 pb-1 transition-colors duration-200 ${o===f?"text-blue-400":"text-gray-400 hover:text-blue-400"}`,children:[e.jsx("i",{className:`fas ${D} text-xl`}),e.jsx("span",{className:"text-xs font-semibold mt-1",children:O})]}),F=({isLocked:f,label:D,children:O})=>e.jsxs("div",{className:"relative",title:f?"Disponible en Plan Silver":"",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:D}),O,f&&e.jsx("div",{className:"absolute inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-end px-4 rounded-md cursor-not-allowed",children:e.jsx("i",{className:"fas fa-lock text-gray-400"})})]});return e.jsxs("div",{className:"max-w-7xl mx-auto pb-24",children:[e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[o==="available"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-6",children:"Cargas Disponibles"}),e.jsxs("div",{className:"bg-blue-900/50 border-l-4 border-blue-500 text-blue-300 p-4 mb-6 rounded-md shadow flex justify-between items-center flex-wrap",role:"alert",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold flex items-center mb-1",children:[e.jsx("i",{className:"fas fa-map-marked-alt mr-2"}),`Plan ${t.plan.charAt(0).toUpperCase()+t.plan.slice(1)} Activado`,": Radio de ",t.plan==="free"?"150":"250"," km"]}),t.plan==="free"&&e.jsx("p",{className:"text-sm",children:"Estás viendo cargas dentro de tu radio de búsqueda. Para desbloquear filtros y un radio mayor, ¡mejora tu plan!"})]}),t.plan==="free"&&e.jsxs("button",{onClick:()=>i("plans"),className:"mt-2 sm:mt-0 bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors duration-300 transform hover:scale-105",children:[e.jsx("i",{className:"fas fa-arrow-alt-circle-up mr-2"}),"Actualizar Plan"]})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("button",{onClick:()=>m("list"),className:`px-4 py-2 rounded-md font-semibold transition-colors ${w==="list"?"bg-[#00529B] text-white shadow":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[e.jsx("i",{className:"fas fa-list mr-2"}),"Ver Lista"]}),e.jsxs("button",{onClick:()=>m("map"),className:`px-4 py-2 rounded-md font-semibold transition-colors ${w==="map"?"bg-[#00529B] text-white shadow":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[e.jsx("i",{className:"fas fa-map-marked-alt mr-2"}),"Ver Mapa"]})]}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg shadow-sm mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-200",children:"Filtrar y Ordenar"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"sort",className:"text-sm font-medium text-gray-400",children:"Ordenar por:"}),e.jsxs("select",{id:"sort",value:y,onChange:f=>S(f.target.value),className:"p-2 border border-gray-600 bg-gray-700 text-white rounded-md text-sm focus:ring-[#F57921]",children:[e.jsx("option",{value:"default",children:"Recomendado"}),e.jsx("option",{value:"price_desc",children:"Mayor Precio"}),e.jsx("option",{value:"price_asc",children:"Menor Precio"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4 border-t border-gray-700 pt-4",children:[e.jsx(F,{isLocked:t.plan==="free",label:"Tipo de Camión",children:e.jsxs("select",{value:l,onChange:f=>N(f.target.value),disabled:t.plan==="free",className:"mt-1 block w-full p-2 border border-gray-600 bg-gray-700 text-white rounded-md shadow-sm focus:outline-none focus:ring-[#F57921] focus:border-[#F57921] sm:text-sm disabled:bg-gray-600",children:[e.jsx("option",{value:"all",children:"Todos"}),mt.map(f=>e.jsx("option",{value:f,children:f.charAt(0).toUpperCase()+f.slice(1)},f))]})}),e.jsx(F,{isLocked:t.plan==="free",label:"Rango de Precio (ARS)",children:e.jsxs("select",{value:R,onChange:f=>x(f.target.value),disabled:t.plan==="free",className:"mt-1 block w-full p-2 border border-gray-600 bg-gray-700 text-white rounded-md shadow-sm focus:outline-none focus:ring-[#F57921] focus:border-[#F57921] sm:text-sm disabled:bg-gray-600",children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"0-1800000",children:"Menos de $1,800,000"}),e.jsx("option",{value:"1800000-2500000",children:"$1,800,000 - $2,500,000"}),e.jsx("option",{value:"2500000",children:"Más de $2,500,000"})]})})]})]}),w==="list"?e.jsx("div",{className:"space-y-4",children:d?B.length>0?B.map(f=>{const D=c.get(f.id);return e.jsx(te,{load:f,onSelect:s,userRole:t.role,distance:D},f.id)}):e.jsx("p",{className:"text-center text-gray-400 bg-gray-800 p-8 rounded-lg shadow-sm",children:"No hay cargas disponibles que coincidan con tus filtros y radio de búsqueda."}):e.jsxs("p",{className:"text-center text-gray-400 bg-gray-800 p-8 rounded-lg shadow-sm flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Esperando ubicación para mostrar cargas..."]})}):d?e.jsx(gt,{user:t,availableLoads:B,userLocation:d,onSelectLoad:s}):e.jsxs("div",{className:"text-center p-8 bg-gray-800 rounded-lg shadow-sm flex items-center justify-center gap-2 h-96",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),"Obteniendo ubicación para mostrar el mapa..."]})]}),o==="my_loads"&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-6",children:"Mis Viajes en Curso"}),e.jsx("div",{className:"space-y-4 mb-10",children:b.length>0?b.map(f=>e.jsx(te,{load:f,onSelect:s,userRole:t.role},f.id)):e.jsx("p",{className:"text-center text-gray-400 bg-gray-800 p-8 rounded-lg shadow-sm",children:"No tienes viajes en curso en este momento."})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-6",children:"Historial de Viajes"}),e.jsx("div",{className:"space-y-4 mb-10",children:G.length>0?G.map(f=>e.jsx(te,{load:f,onSelect:s,userRole:t.role},f.id)):e.jsx("p",{className:"text-center text-gray-400 bg-gray-800 p-8 rounded-lg shadow-sm",children:"No has completado ningún viaje todavía."})})]})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 h-16 bg-gray-800 border-t border-gray-700 shadow-md flex z-40 max-w-7xl mx-auto",children:[e.jsx(E,{tabName:"available",icon:"fa-th-list",label:"Disponibles"}),e.jsx(E,{tabName:"my_loads",icon:"fa-truck",label:"Mis Cargas"})]})]})},me=({icon:t,title:a,children:n})=>e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 transform hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("i",{className:`fas ${t} text-2xl text-brand-500 mr-4`}),e.jsx("h3",{className:"text-xl font-bold text-brand-400",children:a})]}),e.jsx("p",{className:"text-gray-400",children:n})]}),pe=({title:t,price:a,features:n,primary:s=!1,planType:i,onSelectPlan:d,currentUserPlan:o})=>{const j=o===i,w=["free","silver","gold"],m=o?w.indexOf(o):-1,y=w.indexOf(i),S=!!o&&y<=m;return e.jsxs("div",{className:`border rounded-lg p-8 flex flex-col ${s?"bg-gray-900 text-white border-gray-700 transform scale-105 shadow-2xl":"bg-gray-800 text-gray-300 border-gray-700"}`,children:[e.jsx("h3",{className:`text-2xl font-bold ${s?"text-white":"text-brand-400"}`,children:t}),e.jsx("p",{className:"text-4xl font-extrabold my-4 text-gray-100",children:a}),e.jsx("ul",{className:`space-y-3 mb-8 ${s?"":"text-gray-400"}`,children:n.map((l,N)=>l.startsWith("HEADING:")?e.jsx("li",{className:`font-semibold pt-2 ${s?"text-white":"text-gray-200"}`,children:l.replace("HEADING:","")},N):e.jsxs("li",{className:"flex items-start",children:[e.jsx("i",{className:`fas fa-check-circle mr-3 mt-1 flex-shrink-0 ${s?"text-green-300":"text-green-400"}`}),e.jsx("span",{children:l})]},N))}),e.jsx("button",{onClick:()=>d(i),disabled:S,className:`mt-auto font-bold py-3 px-6 rounded-md transition-colors 
                    ${s?"bg-brand-600 text-white hover:bg-brand-500":"bg-gray-700 text-gray-200 hover:bg-gray-600"}
                    ${S?"opacity-50 cursor-not-allowed":""}
                `,children:j?"Plan Actual":S?"Plan Actual o Superior":"Seleccionar Plan"})]})},ft=({onNavigate:t,user:a})=>{const n=s=>{a?t("plans"):(alert("Por favor, inicia sesión para seleccionar un plan."),t("login"))};return e.jsxs("div",{className:"bg-gray-900",children:[e.jsx("section",{className:"bg-cover bg-center text-white py-20 md:py-32",style:{backgroundImage:"linear-gradient(rgba(136, 24, 24, 0.85), rgba(17, 24, 39, 0.9)), url('https://images.unsplash.com/photo-1587293852325-3b1f0c36b30b?q=80&w=2070&auto=format&fit=crop')"},children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 text-center",children:[e.jsx("h1",{className:"text-4xl md:text-6xl font-extrabold tracking-tight mb-4",children:"Conectamos cargas con destinos."}),e.jsx("p",{className:"text-xl md:text-2xl font-light mb-8 max-w-3xl mx-auto",children:"La plataforma inteligente que digitaliza el transporte, uniendo empresas y transportistas. Rápido, seguro y global."}),e.jsx("button",{onClick:()=>t("login"),className:"bg-brand-600 text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-brand-500 transition-all duration-300 transform hover:scale-105 shadow-lg",children:"¡Comienza Ahora!"})]})}),e.jsx("section",{className:"py-16",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-center text-gray-100 mb-12",children:"Beneficios de la Plataforma CargARG"}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-8",children:[e.jsx(me,{icon:"fa-shield-alt",title:"Seguridad Garantizada",children:"Verificación de empresas y transportistas, seguimiento en tiempo real y sistema de calificaciones."}),e.jsx(me,{icon:"fa-bolt",title:"Eficiencia Máxima",children:"Reduce tiempos muertos, optimiza rutas y conecta cargas de retorno para maximizar la rentabilidad."}),e.jsx(me,{icon:"fa-network-wired",title:"Red Extensa",children:"Accede a miles de empresas y transportistas verificados en toda América Latina."}),e.jsx(me,{icon:"fa-brain",title:"IA Avanzada",children:"Tecnología de punta que aprende de cada operación para ofrecer recomendaciones personalizadas."})]})]})}),e.jsx("section",{className:"py-16 bg-gray-800",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[e.jsxs("div",{className:"mb-20",children:[e.jsx("h2",{className:"text-3xl font-bold text-center text-gray-100 mb-12",children:"Para Conductores"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 items-start max-w-4xl mx-auto",children:[e.jsx(pe,{title:"FREE",price:"Gratis",features:["5 asignaciones mensuales","Rango de operación a la redonda: 150 km","Emparejamiento mediado por IA","Chat con IA (coordinación básica)","Identidad verificada","Sin costo de ingreso"],planType:"free",onSelectPlan:n,currentUserPlan:a?.plan}),e.jsx(pe,{title:"SILVER",price:"USD 20/mes",features:["20 asignaciones mensuales","Rango de operación a la redonda: 250 km","GPS con IA predictiva","Chat con IA (coordinación básica)","Identidad verificada","Filtros según camión/remolque","HEADING:Plan Mixto (+ USD 5):","20 asignaciones + 20 publicaciones propias","Publicaciones destacadas en listas"],primary:!0,planType:"silver",onSelectPlan:n,currentUserPlan:a?.plan})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-center text-gray-100 mb-12",children:"Para Empresas de Logística"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 items-start max-w-4xl mx-auto",children:[e.jsx(pe,{title:"FREE",price:"Gratis",features:["15 publicaciones mensuales","Emparejamiento mediado por IA","Chat con IA (coordinación básica)","Identidad verificada del responsable","Sin costo de ingreso"],planType:"free",onSelectPlan:n,currentUserPlan:a?.plan}),e.jsx(pe,{title:"SILVER",price:"USD 20/mes",features:["50 publicaciones mensuales","Emparejamiento con camiones verificados mediante IA","Chat con IA (coordinación básica)","Identidad verificada del responsable","Publicaciones destacadas en listas","Incrementa +10 publicaciones por +USD 10"],primary:!0,planType:"silver",onSelectPlan:n,currentUserPlan:a?.plan})]})]})]})}),e.jsx("footer",{className:"bg-charcoal-900 text-white text-center py-6",children:e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:[e.jsx("span",{children:"Carg"}),e.jsx("span",{className:"text-brand-500",children:"ARG"})]})," © 2025 - Conectamos cargas con destinos. En segundos."]})})]})};function ht(t,a="info",n=4e3){try{window.dispatchEvent(new CustomEvent("app:toast",{detail:{id:Date.now()+Math.random(),message:t,type:a,duration:n}}))}catch{}}const bt=()=>{const[t,a]=r.useState([]);return r.useEffect(()=>{const n=i=>{const{id:d,message:o,type:j,duration:w}=i.detail||{},m=Date.now()+(typeof w=="number"?w:4e3);a(y=>[...y,{id:d,message:o,type:j||"info",expiresAt:m}])};window.addEventListener("app:toast",n);const s=window.setInterval(()=>{const i=Date.now();a(d=>d.filter(o=>o.expiresAt>i))},300);return()=>{window.removeEventListener("app:toast",n),window.clearInterval(s)}},[]),e.jsx("div",{className:"fixed bottom-4 right-4 z-[10000] flex flex-col gap-3",children:t.map(n=>e.jsx("div",{className:`max-w-xs shadow-lg rounded-md px-4 py-3 text-white ${n.type==="success"?"bg-green-600":n.type==="error"?"bg-red-600":"bg-gray-800"}`,children:e.jsx("span",{children:n.message})},n.id))})},yt=({onLogin:t,onRegister:a,onNavigate:n,onGoogleSignIn:s})=>{const[i,d]=r.useState(!0),[o,j]=r.useState(""),[w,m]=r.useState(""),[y,S]=r.useState(!1),[l,N]=r.useState(I.DRIVER),[R,x]=r.useState(""),[c,p]=r.useState(""),[C,L]=r.useState(!1),g=r.useRef(!1),b=async B=>{if(B.preventDefault(),!g.current){g.current=!0,p(""),L(!0);try{if(i)await t(o,w);else{if(l===I.COMPANY&&!R)throw new Error("El nombre de la empresa es obligatorio.");await a(o,w,l,R),ht("Registro exitoso. Revisa tu correo para verificar tu cuenta.","success")}}catch(E){E.message.includes("auth/invalid-credential")?p("Correo o contraseña incorrectos."):E.message.includes("auth/email-already-in-use")?p("Este correo electrónico ya está en uso."):p(E.message||"Ocurrió un error. Por favor, intenta de nuevo.")}finally{L(!1),g.current=!1}}},G=async()=>{if(!g.current){g.current=!0,p(""),L(!0);try{await s(l,R||void 0)}catch(B){let E="Error al iniciar sesión con Google. Intenta de nuevo.";switch(B.code){case"auth/popup-closed-by-user":L(!1);return;case"auth/operation-not-allowed":E="El inicio de sesión con Google no está habilitado. Contacta al soporte.";break;case"auth/popup-blocked":E="El navegador bloqueó la ventana de inicio de sesión. Por favor, habilita las ventanas emergentes.";break;case"auth/account-exists-with-different-credential":E="Ya existe una cuenta con este correo, pero con una contraseña. Intenta iniciar sesión con tu contraseña.";break}p(E)}finally{L(!1),g.current=!1}}};return e.jsxs("div",{className:"max-w-md mx-auto mt-10 mb-10 p-8 bg-gray-800 rounded-lg shadow-xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:[e.jsx("span",{className:"text-white",children:"Carg"}),e.jsx("span",{className:"text-brand-500",children:"ARG"})]}),e.jsx("p",{className:"text-gray-400 mt-2",children:i?"Inicia sesión para continuar":"Crea una cuenta nueva"})]}),e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[c&&e.jsx("p",{className:"bg-red-900/50 text-red-300 p-3 rounded-md text-center",children:c}),!i&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Soy un"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>N(I.DRIVER),className:`flex-1 p-3 rounded-md font-semibold text-center transition ${l===I.DRIVER?"bg-[#00529B] text-white":"bg-gray-700 text-gray-300"}`,children:[e.jsx("i",{className:"fas fa-truck mr-2"}),"Conductor"]}),e.jsxs("button",{type:"button",onClick:()=>N(I.COMPANY),className:`flex-1 p-3 rounded-md font-semibold text-center transition ${l===I.COMPANY?"bg-[#00529B] text-white":"bg-gray-700 text-gray-300"}`,children:[e.jsx("i",{className:"fas fa-building mr-2"}),"Logistica"]})]})]}),e.jsx(Ie,{id:"email",type:"email",label:"Correo Electrónico",value:o,onChange:j,required:!0}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-400",children:"Contraseña"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{id:"password",name:"password",type:y?"text":"password",value:w,onChange:B=>m(B.target.value),required:!0,minLength:6,className:"w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-[#F57921]"}),e.jsx("button",{type:"button",onClick:()=>S(!y),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-gray-200","aria-label":y?"Ocultar contraseña":"Mostrar contraseña",children:e.jsx("i",{className:`fas ${y?"fa-eye":"fa-eye-slash"}`})})]})]}),!i&&l===I.COMPANY&&e.jsx(Ie,{id:"companyName",type:"text",label:"Nombre de la Empresa",value:R,onChange:x,required:!0}),e.jsxs("button",{type:"submit",disabled:C,className:"w-full bg-brand-600 text-white font-bold py-3 rounded-md hover:bg-brand-500 transition-all disabled:bg-gray-500 flex items-center justify-center",children:[C&&e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"}),i?"Iniciar Sesión":"Registrarse"]})]}),e.jsxs("div",{className:"my-6 flex items-center",children:[e.jsx("div",{className:"flex-grow border-t border-gray-600"}),e.jsx("span",{className:"flex-shrink mx-4 text-gray-400 text-sm",children:"O"}),e.jsx("div",{className:"flex-grow border-t border-gray-600"})]}),e.jsxs("button",{onClick:G,disabled:C,className:"w-full bg-gray-700 text-white font-bold py-3 rounded-md hover:bg-gray-600 transition-all disabled:bg-gray-500 flex items-center justify-center",children:[e.jsxs("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 48 48",children:[e.jsx("path",{fill:"#FFC107",d:"M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C12.955 4 4 12.955 4 24s8.955 20 20 20s20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z"}),e.jsx("path",{fill:"#FF3D00",d:"m6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C16.318 4 9.656 8.337 6.306 14.691z"}),e.jsx("path",{fill:"#4CAF50",d:"M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238A11.91 11.91 0 0 1 24 36c-6.627 0-12-5.373-12-12s5.373-12 12-12c5.891 0 10.954 4.168 11.838 9.695H24v8h19.839c.193 1.121.302 2.28.302 3.485c0 11.045-8.955 20-20 20z"}),e.jsx("path",{fill:"#1976D2",d:"M43.611 20.083H42V20H24v8h11.303c-.792 2.237-2.231 4.166-4.087 5.574l6.19 5.238C41.383 35.618 44 30.298 44 24c0-1.341-.138-2.65-.389-3.917z"})]}),"Continuar con Google"]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{onClick:()=>d(!i),className:"text-blue-400 hover:underline text-sm",children:i?"¿No tienes una cuenta? Regístrate":"¿Ya tienes una cuenta? Inicia sesión"})})]})},Ie=({id:t,type:a,label:n,value:s,onChange:i,...d})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:t,className:"block text-sm font-medium text-gray-400",children:n}),e.jsx("input",{id:t,name:t,type:a,value:s,onChange:o=>i(o.target.value),...d,className:"mt-1 w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-[#F57921]"})]}),jt={apiKey:"AIzaSyDzGBbOmK0T99HqRckumFFCQy8hzKdKsYI",authDomain:"cargarg-logistica.firebaseapp.com",projectId:"cargarg-logistica",storageBucket:"cargarg-logistica.firebasestorage.app",messagingSenderId:"172773988865",appId:"1:172773988865:web:b4a4daafae3c3d7bc7fe00",measurementId:"G-3WT4DKPMME"},se=$e(jt),z=Ue(se);try{ze(z,Be).catch(()=>{});try{Ge(z)}catch{}}catch{}let A;try{const t=typeof navigator<"u"?navigator.userAgent:"",a=/iPhone|iPad|iPod|Android/i.test(t);A=je(se,a?{experimentalForceLongPolling:!0,useFetchStreams:!1}:{})}catch{A=je(se,{})}const Le=qe(se),vt=He(se);let Pe=null;try{typeof window<"u"&&se.options?.measurementId&&(Pe=Ye(se))}catch{}const wt=Object.freeze(Object.defineProperty({__proto__:null,get analytics(){return Pe},auth:z,get db(){return A},functions:vt,storage:Le},Symbol.toStringTag,{value:"Module"})),ie=async t=>{if(!t.startsWith("gs://"))return"";try{const a=We(Le,t);return await Ke(a)}catch{return""}},oe=({title:t,url:a})=>e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-sm mb-2 text-gray-400",children:t}),a?e.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:a,alt:t,className:"w-full h-auto rounded-md object-cover aspect-[4/3] bg-gray-700 cursor-pointer shadow-lg"})}):e.jsx("div",{className:"w-full h-auto rounded-md flex items-center justify-center aspect-[4/3] bg-gray-700 text-gray-500",children:e.jsx("i",{className:"fas fa-image text-3xl"})})]}),Nt=({request:t,onApprove:a,onReject:n,onRetry:s})=>{const[i,d]=r.useState(!1),[o,j]=r.useState(""),[w,m]=r.useState(!1),[y,S]=r.useState({dni_front:!1,dni_back:!1,selfie:!1,license_front:!1,license_back:!1}),l=async()=>{if(!o.trim()){alert("Por favor, proporciona un motivo para el rechazo.");return}m(!0),await n(t.user.id,t.log.id,o),m(!1)},N=async()=>{m(!0),await a(t.user.id,t.log.id),m(!1)},R=async()=>{m(!0);const g=Object.entries(y).filter(([,b])=>b).map(([b])=>b);await s(t.user.id,t.log.id,g,o),m(!1)},{user:x,log:c,imageUrls:p}=t,C=c.facialSimilarityScore?(c.facialSimilarityScore*100).toFixed(2):"N/A",L=c.facialSimilarityScore&&c.facialSimilarityScore>=.72?"text-green-400":"text-yellow-400";return e.jsxs("div",{className:"bg-gray-800 rounded-lg overflow-hidden border border-gray-700",children:[e.jsxs("button",{onClick:()=>d(!i),className:"w-full text-left p-4 flex justify-between items-center bg-gray-700/50 hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg text-white",children:x.email}),e.jsxs("p",{className:"text-sm text-gray-400",children:["DNI: ",c.userSubmittedDni||"No especificado"," - Intento #",c.attemptNumber+1]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Proveedor: ",c.provider||"IA"," � Score: ",typeof c.confidenceScore=="number"?Math.round(c.confidenceScore*100):"N/A","%"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`text-sm font-semibold ${c.finalState==="pending_manual"?"text-yellow-400":"text-gray-500"}`,children:c.finalState}),e.jsx("i",{className:`fas fa-chevron-down text-xl transition-transform ${i?"rotate-180":""}`})]})]}),i&&e.jsxs("div",{className:"p-4 md:p-6 grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-bold text-gray-300 border-b border-gray-600 pb-2",children:"Documentos del Usuario"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(oe,{title:"Selfie",url:p.selfie}),e.jsx(oe,{title:"DNI (Frente)",url:p.dniFront}),p.dniBack&&e.jsx(oe,{title:"DNI (Dorso)",url:p.dniBack}),p.licenseFront&&e.jsx(oe,{title:"Licencia (Frente)",url:p.licenseFront}),p.licenseBack&&e.jsx(oe,{title:"Licencia (Dorso)",url:p.licenseBack})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-bold text-gray-300 border-b border-gray-600 pb-2",children:"An�lisis de IA y Acciones"}),e.jsxs("div",{className:"bg-gray-900/50 p-4 rounded-md space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-400",children:"Puntuaci�n de Similitud Facial:"}),e.jsxs("p",{className:`text-2xl font-bold ${L}`,children:[C,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-400",children:"Resultado de Document AI:"}),e.jsx("p",{className:`text-sm ${c.documentVerification?.success?"text-green-400":"text-red-400"}`,children:c.documentVerification?.reason||"No disponible"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-400",children:"Raz�n del Fallo Autom�tico:"}),e.jsx("p",{className:"text-sm text-yellow-400",children:c.errorMessage||"No se registr� un error espec�fico."})]})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsx("textarea",{value:o,onChange:g=>j(g.target.value),placeholder:"Motivo del rechazo o instrucciones para reintento (visible para el usuario)...",className:"w-full p-2 border border-gray-600 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-[#F57921]",rows:2}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-gray-300",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y.dni_front,onChange:g=>S(b=>({...b,dni_front:g.target.checked}))})," DNI Frente"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y.dni_back,onChange:g=>S(b=>({...b,dni_back:g.target.checked}))})," DNI Dorso"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y.selfie,onChange:g=>S(b=>({...b,selfie:g.target.checked}))})," Selfie"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y.license_front,onChange:g=>S(b=>({...b,license_front:g.target.checked}))})," Licencia Frente"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y.license_back,onChange:g=>S(b=>({...b,license_back:g.target.checked}))})," Licencia Dorso"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:l,disabled:w,className:"flex-1 bg-red-600 text-white font-bold py-2 px-4 rounded-md hover:bg-red-700 disabled:bg-red-900 transition-colors",children:w?e.jsx("i",{className:"fas fa-spinner fa-spin"}):"Rechazar"}),e.jsx("button",{onClick:R,disabled:w,className:"flex-1 bg-yellow-600 text-white font-bold py-2 px-4 rounded-md hover:bg-yellow-700 disabled:bg-yellow-900 transition-colors",children:w?e.jsx("i",{className:"fas fa-spinner fa-spin"}):"Solicitar Reintento"}),e.jsx("button",{onClick:N,disabled:w,className:"flex-1 bg-green-600 text-white font-bold py-2 px-4 rounded-md hover:bg-green-700 disabled:bg-green-900 transition-colors",children:w?e.jsx("i",{className:"fas fa-spinner fa-spin"}):"Aprobar"})]})]})]})]})]})},St=({staffUser:t})=>{const[a,n]=r.useState([]),[s,i]=r.useState(!0),[d,o]=r.useState(null),[j,w]=r.useState(""),[m,y]=r.useState(""),S=r.useCallback(async()=>{i(!0),o(null);try{const c=ae(K(A,"users"),ue("perfilEstado","==","pending_review")),C=(await Z(c)).docs.map(g=>{const b=g.data();return{id:g.id,email:b.email,role:b.role,dni:b.dni,companyName:b.companyName,emailVerified:b.emailVerified||!1,perfilEstado:b.perfilEstado,plan:b.plan}}),L=await Promise.all(C.map(async g=>{const b=ae(K(A,"identity_verification_logs",g.id,"attempts"),he("createdAt","desc"),ve(1));let G=await Z(b);if(G.empty){const $=ae(K(A,`users/${g.id}/verification_logs`),he("createdAt","desc"),ve(1));if(G=await Z($),G.empty)return null}const B=G.docs[0],E=B.data(),F={id:B.id,attemptNumber:E.attemptNumber,createdAt:E.createdAt,dniBackUri:E.dniBackUri,dniFrontUri:E.dniFrontUri,selfieUri:E.selfieUri,licenseFrontUri:E.licenseFrontUri,licenseBackUri:E.licenseBackUri,errorMessage:E.errorMessage,facialSimilarityScore:E.facialSimilarityScore,finalState:E.finalState,status:E.status,strategy:E.strategy,userSubmittedDni:E.userSubmittedDni,documentVerification:E.documentVerification,manualVerification:E.manualVerification},[f,D,O,P,h]=await Promise.all([ie(F.selfieUri),ie(F.dniFrontUri),F.dniBackUri?ie(F.dniBackUri):Promise.resolve(null),F.licenseFrontUri?ie(F.licenseFrontUri):Promise.resolve(null),F.licenseBackUri?ie(F.licenseBackUri):Promise.resolve(null)]);return{user:g,log:F,imageUrls:{selfie:f,dniFront:D,dniBack:O,licenseFront:P,licenseBack:h}}}));n(L.filter(Boolean))}catch{o("Error al cargar las solicitudes de verificaci�n.")}finally{i(!1)}},[]);r.useEffect(()=>{S()},[S]);const l=async(c,p,C,L)=>{try{if(C==="approved"){const E=H(A,"identity_verification_logs",c,"attempts",p),D=((await le(E)).data()||{}).userSubmittedDni||null;if(D){const{httpsCallable:O}=await ee(async()=>{const{httpsCallable:W}=await import("./firebase-v84oFIZ0.js").then(ce=>ce.K);return{httpsCallable:W}},[]),{functions:P}=await ee(async()=>{const{functions:W}=await Promise.resolve().then(()=>wt);return{functions:W}},void 0);if((await O(P,"guardDniUniqueness")({dniNumber:D,uid:c}))?.data?.conflict){alert("El DNI pertenece a otro usuario. No se puede aprobar.");return}}}await X(H(A,"users",c),{perfilEstado:C==="approved"?"validada":"rechazada",verificationStatus:C==="approved"?"verified":"banned",verificationFeedback:C==="rejected"?L:null});const g=H(A,"identity_verification_logs",c,"attempts",p),G=(await le(g)).data()||{},B=G.userSubmittedDni||null;await X(g,{manualVerification:{action:C,reason:L||null,verifiedBy:t.id,verifiedAt:J()},finalState:C==="approved"?"validada":"rechazada",status:C==="approved"?"approved":"rejected",attemptStatus:C==="approved"?"approved":"rejected",updatedAt:J()}),B&&await xe(H(A,"dniRegistry",String(B)),{uid:c,verificationStatus:C==="approved"?"verified":"banned",provider:G.provider||"Staff",confidenceScore:G.confidenceScore||null,updatedAt:J()},{merge:!0}),n(E=>E.filter(F=>F.user.id!==c))}catch{alert("Ocurri� un error al procesar la solicitud.")}},N=(c,p)=>l(c,p,"approved"),R=(c,p,C)=>l(c,p,"rejected",C),x=async(c,p,C,L)=>{try{await X(H(A,"identity_verification_logs",c,"attempts",p),{status:"retry_required",requestedComponents:C,feedback:L||null,updatedAt:J()})}catch{}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-gray-700 pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-100",children:"Verificaciones Pendientes"}),e.jsxs("button",{onClick:S,disabled:s,className:"font-semibold py-2 px-4 rounded-md transition-all bg-[#00529B] text-white hover:bg-opacity-90 disabled:bg-gray-600",children:[e.jsx("i",{className:`fas fa-sync ${s?"fa-spin":""} mr-2`}),"Actualizar"]})]}),s&&e.jsx("div",{className:"text-center p-8",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-blue-400"})}),d&&e.jsx("p",{className:"text-center bg-red-900/50 text-red-300 p-4 rounded-md",children:d}),!s&&a.length===0&&e.jsx("p",{className:"text-center text-gray-400 bg-gray-800 p-8 rounded-lg shadow-sm",children:"�Excelente! No hay verificaciones manuales pendientes."}),e.jsx("div",{className:"bg-gray-800 p-4 rounded-lg mb-4 border border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{value:j,onChange:c=>w(c.target.value),placeholder:"Filtrar por DNI/Email/Nombre",className:"p-2 bg-gray-700 border border-gray-600 rounded text-white"}),e.jsx("input",{value:m,onChange:c=>y(c.target.value?Number(c.target.value):""),placeholder:"Intento #",type:"number",min:1,className:"p-2 bg-gray-700 border border-gray-600 rounded text-white"}),e.jsx("button",{onClick:S,disabled:s,className:"p-2 bg-gray-700 border border-gray-600 rounded text-white",children:"Refrescar"})]})}),(()=>{const c=a.filter(p=>{const C=j.trim().toLowerCase(),L=!C||p.user.email?.toLowerCase().includes(C)||p.log.userSubmittedDni?.toLowerCase?.().includes(C),g=!m||p.log.attemptNumber===m;return L&&g});return e.jsx("div",{className:"space-y-4",children:c.map(p=>e.jsx(Nt,{request:p,onApprove:N,onReject:R,onRetry:x},p.user.id))})})()]})},Ct=({user:t,onClose:a,onSave:n})=>{const[s,i]=r.useState(t.plan),[d,o]=r.useState(t.perfilEstado),[j,w]=r.useState(t.companyName||""),[m,y]=r.useState(!1),S=async()=>{y(!0);try{await X(H(A,"users",t.id),{plan:s,perfilEstado:d,companyName:j}),n()}catch{alert("Failed to update user.")}finally{y(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex justify-center items-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6 border border-gray-700",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Editando Usuario"}),e.jsx("p",{className:"text-blue-300 mb-6",children:t.email}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Plan"}),e.jsxs("select",{value:s,onChange:l=>i(l.target.value),className:"mt-1 w-full p-2 border border-gray-600 bg-gray-700 text-white rounded-md",children:[e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"gold",children:"Gold"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Estado de Verificaci�n"}),e.jsxs("select",{value:d,onChange:l=>o(l.target.value),className:"mt-1 w-full p-2 border border-gray-600 bg-gray-700 text-white rounded-md",children:[e.jsx("option",{value:"sin_verificar",children:"Sin Verificar"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"pendiente_manual",children:"Pendiente (Manual)"}),e.jsx("option",{value:"validada",children:"Validada"}),e.jsx("option",{value:"rechazada",children:"Rechazada"})]})]}),t.role===I.COMPANY&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Nombre de Empresa"}),e.jsx("input",{type:"text",value:j,onChange:l=>w(l.target.value),className:"mt-1 w-full p-2 border border-gray-600 bg-gray-700 text-white rounded-md"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-8",children:[e.jsx("button",{onClick:a,className:"bg-gray-600 text-white font-bold py-2 px-4 rounded-md hover:bg-gray-500",children:"Cancelar"}),e.jsx("button",{onClick:S,disabled:m,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-md hover:bg-green-700 disabled:bg-green-800",children:m?e.jsx("i",{className:"fas fa-spinner fa-spin"}):"Guardar Cambios"})]})]})})},kt=()=>{const[t,a]=r.useState([]),[n,s]=r.useState(!0),[i,d]=r.useState(""),[o,j]=r.useState("all"),[w,m]=r.useState(null),y=r.useCallback(async()=>{s(!0);const N=(await Z(K(A,"users"))).docs.map(R=>{const x=R.data();return{id:R.id,email:x.email,role:x.role,dni:x.dni,companyName:x.companyName,emailVerified:x.emailVerified||!1,perfilEstado:x.perfilEstado,plan:x.plan}});a(N),s(!1)},[]);r.useEffect(()=>{y()},[y]);const S=r.useMemo(()=>t.filter(l=>{const N=o==="all"||l.role===o,R=i===""||l.email.toLowerCase().includes(i.toLowerCase())||l.companyName&&l.companyName.toLowerCase().includes(i.toLowerCase());return N&&R}),[t,i,o]);return e.jsxs("div",{children:[w&&e.jsx(Ct,{user:w,onClose:()=>m(null),onSave:()=>{m(null),y()}}),e.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-6",children:"Gesti�n de Perfiles"}),e.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg shadow-sm mb-6 flex flex-wrap gap-4",children:[e.jsx("input",{type:"text",placeholder:"Buscar por email o empresa...",value:i,onChange:l=>d(l.target.value),className:"flex-grow p-2 border border-gray-600 bg-gray-700 text-white rounded-md"}),e.jsxs("select",{value:o,onChange:l=>j(l.target.value),className:"p-2 border border-gray-600 bg-gray-700 text-white rounded-md",children:[e.jsx("option",{value:"all",children:"Todos los Roles"}),e.jsx("option",{value:I.DRIVER,children:"Conductores"}),e.jsx("option",{value:I.COMPANY,children:"Empresas"}),e.jsx("option",{value:I.STAFF,children:"Staff"})]})]}),e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-sm overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-300",children:[e.jsx("thead",{className:"text-xs text-gray-400 uppercase bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Email / Empresa"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Rol"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Plan"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Verificaci�n"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Acci�n"})]})}),e.jsx("tbody",{children:n?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-8",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl"})})}):S.map(l=>e.jsxs("tr",{className:"border-b border-gray-700 hover:bg-gray-700/50",children:[e.jsxs("td",{className:"px-6 py-4 font-medium text-white",children:[l.email,l.companyName&&e.jsx("span",{className:"block text-xs text-gray-400",children:l.companyName})]}),e.jsx("td",{className:"px-6 py-4 capitalize",children:l.role}),e.jsx("td",{className:"px-6 py-4 capitalize",children:l.plan}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${l.perfilEstado==="validada"?"bg-green-900 text-green-300":"bg-yellow-900 text-yellow-300"}`,children:l.perfilEstado.replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>m(l),className:"font-medium text-blue-400 hover:underline",children:"Editar"})})]},l.id))})]})})]})},Et=t=>{const a=t.data(),n={address:"Ubicaci�n no especificada",lat:-34.6037,lng:-58.3816,placeId:""},s=a.startLocation&&typeof a.startLocation.address=="string"?a.startLocation:{...n,address:a.origin||n.address},i=a.endLocation&&typeof a.endLocation.address=="string"?a.endLocation:{...n,address:a.destination||n.address};return{id:t.id,createdAt:a.createdAt,companyId:a.companyId,driverId:a.driverId,status:a.status,startLocation:s,endLocation:i,price:a.price||0,company:a.company||"Empresa Desconocida",cargoDetails:a.cargoDetails||"",requirements:a.requirements||[],requiredTruckType:a.requiredTruckType||[],paymentDetails:a.paymentDetails||{method:"transferencia",terms:"Contra entrega"},companyRating:a.companyRating,driverRating:a.driverRating}},Rt=()=>{const[t,a]=r.useState([]),[n,s]=r.useState(!0),[i,d]=r.useState("all"),[o,j]=r.useState("list"),w=r.useRef(null),[m,y]=r.useState(!!window.google);r.useEffect(()=>{(async()=>{s(!0);const R=ae(K(A,"loads"),he("createdAt","desc")),c=(await Z(R)).docs.map(Et);a(c),s(!1)})()},[]);const S=r.useMemo(()=>i==="all"?t:t.filter(N=>N.status===i),[t,i]);r.useEffect(()=>{if(!m){const x=setInterval(()=>{window.google&&(y(!0),clearInterval(x))},100);return()=>clearInterval(x)}if(o!=="map"||!w.current||!m)return;const N=new window.google.maps.Map(w.current,{center:{lat:-34.6037,lng:-58.3816},zoom:4,styles:[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]});t.filter(x=>x.status===_.AVAILABLE||x.status===_.IN_PROGRESS).forEach(x=>{const c={lat:x.startLocation.lat,lng:x.startLocation.lng},p={lat:x.endLocation.lat,lng:x.endLocation.lng};new window.google.maps.Marker({position:c,map:N,title:`Origen: ${x.startLocation.address}`,icon:"https://maps.google.com/mapfiles/ms/icons/green-dot.png"}),new window.google.maps.Marker({position:p,map:N,title:`Destino: ${x.endLocation.address}`,icon:"https://maps.google.com/mapfiles/ms/icons/red-dot.png"}),x.status===_.IN_PROGRESS&&new window.google.maps.Polyline({path:[c,p],map:N,geodesic:!0,strokeColor:"#F57921",strokeOpacity:.8,strokeWeight:2})})},[o,S,m,t]);const l=({tabId:N,label:R})=>e.jsx("button",{onClick:()=>d(N),className:`px-4 py-2 text-sm font-semibold rounded-md transition-colors ${i===N?"bg-blue-600 text-white":"text-gray-300 bg-gray-700 hover:bg-gray-600"}`,children:R});return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-100 mb-6",children:"Todas las Cargas y Viajes"}),e.jsxs("div",{className:"flex justify-between items-center mb-4 flex-wrap gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{tabId:"all",label:"Todos"}),e.jsx(l,{tabId:_.AVAILABLE,label:"Disponibles"}),e.jsx(l,{tabId:_.IN_PROGRESS,label:"En Curso"}),e.jsx(l,{tabId:_.COMPLETED,label:"Completados"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>j("list"),className:`px-4 py-2 rounded-md font-semibold transition-colors ${o==="list"?"bg-[#00529B] text-white":"bg-gray-700"}`,children:[e.jsx("i",{className:"fas fa-list mr-2"}),"Lista"]}),e.jsxs("button",{onClick:()=>j("map"),className:`px-4 py-2 rounded-md font-semibold transition-colors ${o==="map"?"bg-[#00529B] text-white":"bg-gray-700"}`,children:[e.jsx("i",{className:"fas fa-map-marked-alt mr-2"}),"Mapa"]})]})]}),n?e.jsx("div",{className:"text-center p-8",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-blue-400"})}):o==="list"?e.jsx("div",{className:"space-y-4",children:S.map(N=>e.jsx(te,{load:N,onSelect:()=>{},userRole:I.STAFF},N.id))}):e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden h-[60vh]",children:e.jsx("div",{ref:w,className:"w-full h-full"})})]})},It=({user:t})=>{const[a,n]=r.useState("verification"),s=({viewName:i,icon:d,label:o})=>e.jsxs("button",{onClick:()=>n(i),className:`w-full flex items-center p-3 rounded-md text-left transition-colors ${a===i?"bg-[#00529B] text-white":"text-gray-300 hover:bg-gray-700"}`,children:[e.jsx("i",{className:`fas ${d} w-8 text-center text-lg`}),e.jsx("span",{className:"font-semibold",children:o})]});return e.jsxs("div",{className:"flex",style:{height:"calc(100vh - 68px)"},children:[e.jsxs("aside",{className:"w-64 bg-gray-800 p-4 border-r border-gray-700 flex flex-col",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-400 mb-6 px-2",children:"Panel de Staff"}),e.jsxs("nav",{className:"space-y-2",children:[e.jsx(s,{viewName:"verification",icon:"fa-user-check",label:"Verificaci�n Manual"}),e.jsx(s,{viewName:"users",icon:"fa-users",label:"Perfiles de Usuario"}),e.jsx(s,{viewName:"loads",icon:"fa-truck-loading",label:"Todas las Cargas"})]})]}),e.jsxs("main",{className:"flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto bg-gray-900",children:[a==="verification"&&e.jsx(St,{staffUser:t}),a==="users"&&e.jsx(kt,{}),a==="loads"&&e.jsx(Rt,{})]})]})},At=re.lazy(()=>ee(()=>import("./ChatBot-DQewkl5q.js"),__vite__mapDeps([0,1,2,3])).then(t=>({default:t.VerifyAccountPage}))),Lt=re.lazy(()=>ee(()=>import("./ChatBot-DQewkl5q.js"),__vite__mapDeps([0,1,2,3])).then(t=>({default:t.VerifyIdPage}))),Pt=re.lazy(()=>ee(()=>import("./ChatBot-DQewkl5q.js"),__vite__mapDeps([0,1,2,3])).then(t=>({default:t.PostLoadPage}))),Tt=re.lazy(()=>ee(()=>import("./ChatBot-DQewkl5q.js"),__vite__mapDeps([0,1,2,3])).then(t=>({default:t.LoadDetailsPage}))),Dt=re.lazy(()=>ee(()=>import("./ChatBot-DQewkl5q.js"),__vite__mapDeps([0,1,2,3])).then(t=>({default:t.PlansPage}))),Mt=re.lazy(()=>ee(()=>import("./ChatBot-DQewkl5q.js"),__vite__mapDeps([0,1,2,3])).then(t=>({default:t.PendingVerificationPage}))),_t=()=>{const[t,a]=r.useState(null),[n,s]=r.useState([]),[i,d]=r.useState([]),[o,j]=r.useState("landing"),[w,m]=r.useState(!1),[y,S]=r.useState(null),[l,N]=r.useState(null),[R,x]=r.useState(!0),[c,p]=r.useState(navigator.onLine),C=r.useRef(!1),L=r.useRef(!1);r.useEffect(()=>{const u=()=>p(!0),v=()=>p(!1);return window.addEventListener("online",u),window.addEventListener("offline",v),()=>{window.removeEventListener("online",u),window.removeEventListener("offline",v)}},[]),r.useEffect(()=>{const u=setTimeout(()=>x(!1),1500);return()=>clearTimeout(u)},[]),r.useEffect(()=>{if(t&&!t.emailVerified){const u=setInterval(async()=>{try{await z.currentUser?.reload(),z.currentUser?.emailVerified&&a(v=>v&&{...v,emailVerified:!0})}catch{}},3e3);return()=>clearInterval(u)}},[t?.id,t?.emailVerified]),r.useEffect(()=>{(async()=>{try{L.current=!0;const u=await Qe(z);if(u?.user){const v=u.user,U=H(A,"users",v.uid),V=sessionStorage.getItem("cargarg:intendedRole")||I.DRIVER,M=sessionStorage.getItem("cargarg:intendedCompany");await xe(U,{uid:v.uid,email:(v.email||"").toLowerCase().trim(),role:V,companyName:V===I.COMPANY&&M||null,perfilEstado:"pending_attempt1",verificationStatus:"pending",plan:"free",createdAt:J()},{merge:!0}),sessionStorage.removeItem("cargarg:intendedRole"),sessionStorage.removeItem("cargarg:intendedCompany")}}catch{}finally{sessionStorage.removeItem("cargarg:doRedirectResult"),L.current=!1}})()},[]),r.useEffect(()=>{navigator.geolocation.getCurrentPosition(v=>N({lat:v.coords.latitude,lng:v.coords.longitude}),()=>N({lat:-34.6037,lng:-58.3816}));const u=Je(z,async v=>{if(!(C.current&&!v)){if(v){const U=H(A,"users",v.uid);let V=await le(U);if(!V.exists())try{const M=sessionStorage.getItem("cargarg:intendedRole")||I.DRIVER,T=sessionStorage.getItem("cargarg:intendedCompany");await xe(U,{uid:v.uid,email:(v.email||"").toLowerCase().trim(),role:M,companyName:M===I.COMPANY&&T||null,perfilEstado:"pending_attempt1",verificationStatus:"pending",plan:"free",createdAt:J()}),V=await le(U),sessionStorage.removeItem("cargarg:intendedRole"),sessionStorage.removeItem("cargarg:intendedCompany")}catch{}if(V.exists()){const M=V.data(),T={id:v.uid,email:M.email,role:M.role,dni:M.dni,companyName:M.companyName,perfilEstado:M.perfilEstado,plan:M.plan,emailVerified:v.emailVerified};a(T),T.role===I.STAFF?j("staffDashboard"):T.emailVerified&&T.perfilEstado==="validada"&&(await g(T),j("dashboard"))}}else a(null),s([]),d([]),j("landing");x(!1)}});return()=>u()},[]);const g=async u=>{if(u.role===I.STAFF)try{const k=(await Z(K(A,"users"))).docs.map(q=>{const Y=q.data();return{id:q.id,email:Y.email,role:Y.role,dni:Y.dni,companyName:Y.companyName,perfilEstado:Y.perfilEstado,plan:Y.plan,emailVerified:!1}});d(k)}catch{d([])}else d([]);const v=T=>{const k=T.data(),q={address:"Ubicaci�n no especificada",lat:-34.6037,lng:-58.3816,placeId:""},Y=k.startLocation&&typeof k.startLocation.address=="string"?k.startLocation:{...q,address:k.origin||q.address},Q=k.endLocation&&typeof k.endLocation.address=="string"?k.endLocation:{...q,address:k.destination||q.address};return{id:T.id,createdAt:k.createdAt&&k.createdAt.toMillis?k.createdAt.toMillis():k.createdAt,companyId:k.companyId,driverId:k.driverId,status:k.status,startLocation:Y,endLocation:Q,price:k.price||0,company:k.company||"Empresa Desconocida",cargoDetails:k.cargoDetails||"",requirements:k.requirements||[],requiredTruckType:k.requiredTruckType||[],paymentDetails:k.paymentDetails||{method:"transferencia",terms:"Contra entrega"},companyRating:k.companyRating,driverRating:k.driverRating}};if(u.role===I.DRIVER){const T=ae(K(A,"loads"),Ze(ue("status","==",_.AVAILABLE),ue("driverId","==",u.id))),q=(await Z(T)).docs.map(v);s(q.sort((Y,Q)=>Q.createdAt-Y.createdAt));return}let U;u.role===I.COMPANY?U=ae(K(A,"loads"),ue("companyId","==",u.id)):U=ae(K(A,"loads"));const M=(await Z(U)).docs.map(v);s(M.sort((T,k)=>k.createdAt-T.createdAt))},b=u=>{window.scrollTo(0,0),j(u)},G=async(u,v)=>rt(z,u,v),B=async(u,v,U,V)=>{C.current=!0;let M;try{M=await at(z,u,v);const T=M.user,k=T.uid,q={uid:k,email:(u||"").toLowerCase().trim(),role:U,companyName:V||null,perfilEstado:"pending_attempt1",verificationStatus:"pending",plan:"free",createdAt:J()};await Ne(A,async Q=>{const de=H(A,"users",k);(await Q.get(de)).exists()||Q.set(de,q)}),await Se(T);const Y={id:k,email:u,role:U,companyName:V||"",perfilEstado:"pending_attempt1",verificationStatus:"pending",plan:"free",emailVerified:T.emailVerified};a(Y)}catch(T){throw M&&await st(M.user),T.code==="auth/email-already-in-use"?new Error("Este correo electr�nico ya est� en uso."):new Error("Ocurri� un error durante el registro. Por favor, intenta de nuevo.")}finally{C.current=!1}},E="cargarg:intendedRole",F="cargarg:intendedCompany",f=async(u,v)=>{const U=new et;U.setCustomParameters({prompt:"select_account"});try{u&&sessionStorage.setItem(E,u),v&&sessionStorage.setItem(F,v);const V=window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||navigator.standalone===!0,M=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);if(V||M){sessionStorage.setItem("cargarg:doRedirectResult","1"),await we(z,U);return}const k=(await tt(z,U)).user,q=H(A,"users",k.uid);if(!(await le(q)).exists()){const Q=sessionStorage.getItem(E)||I.DRIVER,de=sessionStorage.getItem(F),be={uid:k.uid,email:(k.email||"").toLowerCase().trim(),role:Q,companyName:Q===I.COMPANY&&de||null,perfilEstado:"pending_attempt1",verificationStatus:"pending",plan:"free",createdAt:J()};await Ne(A,async ye=>{(await ye.get(q)).exists()||ye.set(q,be)}),sessionStorage.removeItem(E),sessionStorage.removeItem(F)}}catch(V){if(V?.code==="auth/operation-not-supported-in-this-environment"||V?.code==="auth/popup-blocked"||V?.code==="auth/cancelled-popup-request"){sessionStorage.setItem("cargarg:doRedirectResult","1"),await we(z,U);return}throw V}},D=async()=>{await Xe(z)},O=u=>{S(u),b("loadDetails")},P=async u=>{if(!t)return;const v=H(K(A,"loads"));await xe(v,{...u,companyId:t.id,createdAt:J()}),t&&await g(t),b("dashboard")},h=async u=>{if(!t||t.role!==I.DRIVER)return;const v=H(A,"loads",u.id);await X(v,{status:_.IN_PROGRESS,driverId:t.id}),await g(t),b("dashboard")},$=async(u,v,U)=>{const V=H(A,"loads",u.id);await X(V,{status:_.COMPLETED,companyRating:U}),t&&await g(t),b("dashboard")},W=async()=>{if(z.currentUser)try{await Se(z.currentUser),alert("Se ha reenviado el correo de verificaci�n.")}catch{alert("Hubo un error al reenviar el correo.")}},ce=async()=>{z.currentUser&&(await z.currentUser.reload(),z.currentUser.emailVerified&&t&&!t.emailVerified&&a(u=>({...u,emailVerified:!0})))},De=(u,v)=>{t&&a({...t,perfilEstado:v,dni:u})},Me=async u=>{if(!t)return;const v=H(A,"users",t.id);await X(v,{plan:u}),a({...t,plan:u}),b("dashboard"),alert(`Plan actualizado a ${u}!`)},_e=async()=>{if(!t){b("login");return}if(!window.confirm("¿Seguro que deseas cancelar tu suscripción?"))return;const v=H(A,"users",t.id);await X(v,{plan:"free"}),a({...t,plan:"free"}),alert("Suscripción cancelada. Has vuelto al plan Free."),b("dashboard")},Ve=()=>{if(R&&t)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"inline-block w-10 h-10 border-4 border-blue-400 border-t-transparent rounded-full animate-spin","aria-label":"loading"})});if(!t)return o==="login"?e.jsx(yt,{onLogin:G,onRegister:B,onNavigate:b,onGoogleSignIn:f}):e.jsx(ft,{onNavigate:b,user:t});if(t.role===I.STAFF)return e.jsx(It,{user:t});if(!t.emailVerified)return e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-[60vh]",children:e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-blue-400 border-t-transparent rounded-full animate-spin","aria-label":"loading"})}),children:e.jsx(At,{email:t.email,onCheckVerification:ce,onResendVerification:W,onLogout:D})});if(t.perfilEstado!=="validada")return t.perfilEstado==="pending_review"?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-[60vh]",children:e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-blue-400 border-t-transparent rounded-full animate-spin","aria-label":"loading"})}),children:e.jsx(Mt,{onLogout:D})}):e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-[60vh]",children:e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-blue-400 border-t-transparent rounded-full animate-spin","aria-label":"loading"})}),children:e.jsx(Lt,{user:t,onIdentitySubmitted:De,onLogout:D})});switch(o){case"dashboard":return e.jsx(Re,{user:t,allUsers:i,loads:n,onSelectLoad:O,onNavigate:b,userLocation:l});case"loadDetails":return y?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-[60vh]",children:e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-blue-400 border-t-transparent rounded-full animate-spin","aria-label":"loading"})}),children:e.jsx(Tt,{load:y,user:t,onBack:()=>b("dashboard"),onAcceptLoad:h,onCompleteLoad:$,userLocation:l})}):e.jsx("p",{children:"Carga no encontrada. Vuelve al panel."});case"postLoad":return e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-[60vh]",children:e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-blue-400 border-t-transparent rounded-full animate-spin","aria-label":"loading"})}),children:e.jsx(Pt,{user:t,onAddLoad:P,onBack:()=>b("dashboard")})});case"plans":return e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-[60vh]",children:e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-blue-400 border-t-transparent rounded-full animate-spin","aria-label":"loading"})}),children:e.jsx(Dt,{user:t,onBack:()=>b("dashboard"),onUpgradePlan:Me})});default:return e.jsx(Re,{user:t,allUsers:i,loads:n,onSelectLoad:O,onNavigate:b,userLocation:l})}};return e.jsxs("div",{className:"bg-gray-900 min-h-screen text-white font-sans",children:[!c&&e.jsxs("div",{className:"bg-yellow-500 text-black text-center p-2 font-semibold fixed top-0 w-full z-[100]",children:[e.jsx("i",{className:"fas fa-exclamation-triangle mr-2"}),"Est�s desconectado. La funcionalidad puede ser limitada."]}),e.jsx(ot,{user:t,onNavigate:b,onLogout:D,isOnline:c,onCancelSubscription:_e}),e.jsx("main",{children:Ve()}),e.jsx(bt,{})]})};(()=>{const t="cargarg-inline-feedback-style";if(!document.getElementById(t)){const s=document.createElement("style");s.id=t,s.textContent=`
      .cargarg-feedback {
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 500;
        line-height: 1.25rem;
        background: rgba(46, 204, 113, 0.10);
        border: 1px solid rgba(46, 204, 113, 0.35);
        color: #2ecc71;
        display: none;
        opacity: 0;
        transition: opacity 0.3s ease-in-out, margin-top 0.3s ease-in-out;
        text-align: center;
      }
      .cargarg-feedback.show { display: block; opacity: 1; }
      .cargarg-feedback.error {
        background: rgba(231, 76, 60, 0.10);
        border-color: rgba(231, 76, 60, 0.35);
        color: #e74c3c;
      }
    `,document.head.appendChild(s)}function a(){let s=document.getElementById("cargarg-feedback-box");if(s)return s;s=document.createElement("div"),s.id="cargarg-feedback-box",s.className="cargarg-feedback";const i=document.querySelector("form");return i&&i.parentElement?(i.parentElement.insertBefore(s,i.nextSibling),s):(document.body.appendChild(s),s)}function n(s,i="success",d=5e3){const o=a();o.classList.remove("error","show"),i==="error"&&o.classList.add("error"),o.textContent=s,o.offsetWidth,o.classList.add("show"),o._hideT&&clearTimeout(o._hideT),o._hideT=window.setTimeout(()=>{o.classList.remove("show")},d)}window._originalAlert||(window._originalAlert=window.alert.bind(window)),window.alert=s=>{const i=String(s??""),d=/error|fail|incorrect|invalid|denied|ya está en uso|contraseña|correo/i.test(i)&&!/exitoso/i.test(i);n(i,d?"error":"success")},window._originalConfirm||(window._originalConfirm=window.confirm.bind(window)),window.confirm=s=>!0,window._originalPrompt||(window._originalPrompt=window.prompt.bind(window)),window.prompt=(s,i)=>i||null})();const Te=document.getElementById("root");if(!Te)throw new Error("Could not find root element to mount to");const Vt=Fe.createRoot(Te);Vt.render(e.jsx(re.StrictMode,{children:e.jsx(_t,{})}));export{_ as L,I as U,ee as _,A as d,vt as f,zt as g,Le as s,mt as t};
