const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BK2eRnKF.js","assets/vendor-CuDMUxSy.js","assets/genai-BuPwoIhQ.js","assets/firebase-v84oFIZ0.js","assets/index-8Q2q8G1x.css","assets/verificationOrchestrator-aFobkJ0i.js"])))=>i.map(i=>d[i]);
import{U as Y,L as ee,t as de,_ as X,s as te,d as ue}from"./index-BK2eRnKF.js";import{j as e,r as s}from"./vendor-CuDMUxSy.js";import{r as ae,I as se,j as ne,n as K,k as me,f as pe,h as xe,m as fe,t as le}from"./firebase-v84oFIZ0.js";import"./genai-BuPwoIhQ.js";const W=({title:a,price:f,features:h,primary:t=!1,planType:l,onSelectPlan:o,currentUserPlan:v})=>{const m=v===l,N=["free","silver","gold"],T=v?N.indexOf(v):-1,L=N.indexOf(l),k=!!v&&L<=T;return e.jsxs("div",{className:`border rounded-lg p-8 flex flex-col ${t?"bg-[#00529B] text-white border-blue-700 transform scale-105 shadow-2xl":"bg-gray-800 text-gray-300 border-gray-700"}`,children:[e.jsx("h3",{className:`text-2xl font-bold ${t?"":"text-blue-400"}`,children:a}),e.jsx("p",{className:`text-4xl font-extrabold my-4 ${t?"text-[#F57921]":"text-gray-100"}`,children:f}),e.jsx("ul",{className:`space-y-3 mb-8 ${t?"":"text-gray-400"}`,children:h.map((u,C)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("i",{className:`fas fa-check-circle mr-3 mt-1 flex-shrink-0 ${t?"text-green-300":"text-green-400"}`}),e.jsx("span",{children:u})]},C))}),e.jsx("button",{onClick:()=>o(l),disabled:k,className:`mt-auto font-bold py-3 px-6 rounded-md transition-colors 
                    ${t?"bg-[#F57921] text-white hover:bg-orange-500":"bg-gray-700 text-gray-200 hover:bg-gray-600"}
                    ${k?"opacity-50 cursor-not-allowed":""}
                `,children:m?"Plan Actual":k?"Plan Actual o Superior":"Seleccionar Plan"})]})},Ne=({user:a,onBack:f,onUpgradePlan:h})=>{const t=a.role===Y.DRIVER?e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 items-start max-w-4xl mx-auto",children:[e.jsx(W,{title:"FREE",price:"Gratis",features:["5 asignaciones mensuales","Rango de operación: 150 km","Emparejamiento por IA","Chat con IA (básico)"],planType:"free",onSelectPlan:h,currentUserPlan:a.plan}),e.jsx(W,{title:"SILVER",price:"USD 20/mes",features:["20 asignaciones mensuales","Rango de operación: 250 km","GPS con IA predictiva","Filtros avanzados"],primary:!0,planType:"silver",onSelectPlan:h,currentUserPlan:a.plan})]}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 items-start max-w-4xl mx-auto",children:[e.jsx(W,{title:"FREE",price:"Gratis",features:["15 publicaciones mensuales","Emparejamiento por IA","Chat con IA (básico)","Identidad verificada"],planType:"free",onSelectPlan:h,currentUserPlan:a.plan}),e.jsx(W,{title:"SILVER",price:"USD 20/mes",features:["50 publicaciones mensuales","Publicaciones destacadas","Emparejamiento con camiones verificados","Soporte prioritario"],primary:!0,planType:"silver",onSelectPlan:h,currentUserPlan:a.plan})]});return e.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsx("button",{onClick:f,className:"text-blue-400 hover:underline mb-6",children:"← Volver al panel"}),e.jsx("h2",{className:"text-3xl font-bold text-center text-gray-100 mb-4",children:"Elige tu Plan"}),e.jsx("p",{className:"text-center text-gray-400 mb-12",children:"Desbloquea más funciones y haz crecer tu negocio con nuestros planes premium."}),t]})},we=({email:a,onCheckVerification:f,onResendVerification:h,onLogout:t})=>{const[l,o]=s.useState(0);s.useEffect(()=>{if(l>0){const m=setTimeout(()=>o(l-1),1e3);return()=>clearTimeout(m)}},[l]);const v=()=>{h(),o(60)};return e.jsxs("div",{className:"max-w-md mx-auto mt-20 p-8 bg-gray-800 rounded-lg shadow-xl text-center",children:[e.jsx("i",{className:"fas fa-envelope-open-text text-5xl text-blue-400 mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Verifica tu correo electrónico"}),e.jsxs("p",{className:"text-gray-400 mb-6",children:["Hemos enviado un enlace de verificación a ",e.jsx("strong",{className:"text-gray-200",children:a}),". Por favor, haz clic en el enlace para activar tu cuenta."]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:f,className:"w-full bg-[#F57921] text-white font-bold py-3 rounded-md hover:bg-opacity-90 transition-all",children:"Ya verifiqué mi correo"}),e.jsx("button",{onClick:v,disabled:l>0,className:"w-full bg-gray-700 text-gray-300 font-bold py-3 rounded-md hover:bg-gray-600 transition-all disabled:opacity-50",children:l>0?`Reenviar en ${l}s`:"Reenviar correo"})]}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-red-400 mt-8 text-sm",children:"Cerrar sesión"})]})},ke=({onLogout:a})=>e.jsxs("div",{className:"max-w-md mx-auto mt-20 p-8 bg-gray-800 rounded-lg shadow-xl text-center",children:[e.jsx("i",{className:"fas fa-user-clock text-5xl text-yellow-400 mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Verificación en Proceso"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Hemos recibido tus documentos. Nuestro equipo los revisará en las próximas 24-48 horas hábiles. Recibirás una notificación por correo electrónico una vez que el proceso haya finalizado."}),e.jsx("button",{onClick:a,className:"text-gray-500 hover:text-red-400 mt-4 text-sm",children:"Cerrar sesión"})]}),ge=({start:a,end:f})=>{const h=s.useRef(null);return s.useEffect(()=>{if(!h.current)return;(async()=>{try{const{Map:l,LatLngBounds:o}=await window.google.maps.importLibrary("maps"),{Marker:v}=await window.google.maps.importLibrary("marker"),m=new l(h.current,{disableDefaultUI:!0,styles:[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]}),N=new o;new v({position:a,map:m,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:8,fillColor:"#4CAF50",fillOpacity:1,strokeWeight:1,strokeColor:"#fff"}}),new v({position:f,map:m,icon:"https://maps.google.com/mapfiles/ms/icons/truck.png"}),N.extend(a),N.extend(f),m.fitBounds(N,50)}catch{}})()},[a,f]),e.jsx("div",{ref:h,className:"h-64 w-full rounded-lg"})},he=({load:a,user:f,userLocation:h})=>{const[t,l]=s.useState([{sender:"ai",text:"Hola, soy tu asistente de CargARG. ¿En qué puedo ayudarte con esta carga?"}]),[o,v]=s.useState(""),[m,N]=s.useState(!1),T=s.useRef(null),L=()=>{T.current?.scrollIntoView({behavior:"smooth"})};s.useEffect(L,[t]);const k=async()=>{if(!o.trim())return;const u={sender:"user",text:o};l(F=>[...F,u]),v(""),N(!0);const{getChatResponse:C}=await X(async()=>{const{getChatResponse:F}=await import("./index-BK2eRnKF.js").then(S=>S.g);return{getChatResponse:F}},__vite__mapDeps([0,1,2,3,4])),D=await C(o,a,f,h),p={sender:"ai",text:D.text,sources:D.sources};l(F=>[...F,p]),N(!1)};return e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-inner flex flex-col h-full max-h-[70vh]",children:[e.jsx("div",{className:"p-4 border-b border-gray-700",children:e.jsx("h3",{className:"text-lg font-bold text-blue-400",children:"Asistente IA"})}),e.jsxs("div",{className:"flex-1 p-4 overflow-y-auto space-y-4",children:[t.map((u,C)=>e.jsxs("div",{className:`flex items-end gap-2 ${u.sender==="user"?"justify-end":"justify-start"}`,children:[u.sender==="ai"&&e.jsx("i",{className:"fas fa-robot text-blue-400 text-xl self-start"}),e.jsxs("div",{className:`max-w-xs md:max-w-md p-3 rounded-lg ${u.sender==="user"?"bg-[#00529B] text-white":"bg-gray-700 text-gray-200"}`,children:[e.jsx("p",{children:u.text}),u.sources&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-600",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-400 mb-1",children:"Fuentes:"}),e.jsx("ul",{className:"text-xs space-y-1",children:u.sources.map((D,p)=>e.jsx("li",{children:e.jsx("a",{href:D.uri,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline truncate block",children:D.title})},p))})]})]})]},C)),m&&e.jsx("div",{className:"flex justify-start",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-blue-400 text-xl"})}),e.jsx("div",{ref:T})]}),e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:u=>v(u.target.value),onKeyPress:u=>u.key==="Enter"&&k(),placeholder:"Pregunta sobre la carga...",className:"flex-1 p-2 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-[#F57921]"}),e.jsx("button",{onClick:k,disabled:m,className:"bg-[#F57921] px-4 rounded-md text-white font-bold disabled:opacity-50",children:e.jsx("i",{className:"fas fa-paper-plane"})})]})})]})},Ce=({load:a,user:f,onBack:h,onAcceptLoad:t,onCompleteLoad:l,userLocation:o})=>{const[v,m]=s.useState(!1),[N,T]=s.useState(0),[L,k]=s.useState(null),[u,C]=s.useState(!1),D=async()=>{if(!L||N===0){alert("Por favor, sube el remito y deja una calificación.");return}C(!0);try{const R=ae(te,`pods/${a.id}/${L.name}`),z=await se(R,L),E=await ne(z.ref);l(a,E,N)}catch{alert("Error al completar la carga. Inténtalo de nuevo.")}finally{C(!1),m(!1)}},p=f.role===Y.DRIVER;f.role,Y.COMPANY;const F=p&&a.status===ee.AVAILABLE,S=p&&a.status===ee.IN_PROGRESS&&a.driverId===f.id,O=R=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(R);return e.jsxs("div",{className:"max-w-6xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsx("button",{onClick:h,className:"text-blue-400 hover:underline mb-6",children:"← Volver"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Detalles de la Carga #",a.id.substring(0,6)]}),e.jsxs("p",{className:"text-gray-400",children:["Publicado por ",a.company]})]}),e.jsx("span",{className:"text-2xl font-bold text-green-400",children:O(a.price)})]}),e.jsx(ge,{start:a.startLocation,end:a.endLocation}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-blue-400",children:"Origen:"}),e.jsx("p",{children:a.startLocation.address})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-blue-400",children:"Destino:"}),e.jsx("p",{children:a.endLocation.address})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-blue-400",children:"Carga:"}),e.jsx("p",{children:a.cargoDetails})]}),a.requiredTruckType&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-blue-400",children:"Camión Requerido:"}),e.jsx("p",{className:"capitalize",children:a.requiredTruckType.join(", ")})]}),a.requirements?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-blue-400",children:"Requisitos:"}),e.jsx("p",{children:a.requirements.join(", ")})]})]}),F&&e.jsx("button",{onClick:()=>t(a),className:"w-full mt-6 bg-[#F57921] text-white font-bold py-3 rounded-md hover:bg-opacity-90 transition-all",children:"Aceptar Viaje"}),S&&e.jsx("button",{onClick:()=>m(!0),className:"w-full mt-6 bg-green-600 text-white font-bold py-3 rounded-md hover:bg-green-700 transition-all",children:"Completar Viaje"})]}),e.jsx("div",{className:"h-[70vh]",children:e.jsx(he,{load:a,user:f,userLocation:o})})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg shadow-xl max-w-md w-full",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Completar Viaje"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Subir Remito (POD)"}),e.jsx("input",{type:"file",onChange:R=>k(R.target.files?R.target.files[0]:null),className:"w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-gray-200 hover:file:bg-gray-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Calificar a la empresa"}),e.jsx("div",{className:"flex justify-center text-3xl",children:[1,2,3,4,5].map(R=>e.jsx("button",{onClick:()=>T(R),className:`mx-1 ${R<=N?"text-yellow-400":"text-gray-600"}`,children:e.jsx("i",{className:"fas fa-star"})},R))})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-8",children:[e.jsx("button",{onClick:()=>m(!1),className:"bg-gray-700 py-2 px-4 rounded-md",children:"Cancelar"}),e.jsx("button",{onClick:D,disabled:u,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-md disabled:bg-gray-500",children:u?"Procesando...":"Confirmar"})]})]})})]})},Re=({user:a,onAddLoad:f,onBack:h})=>{const[t,l]=s.useState(""),[o,v]=s.useState(null),[m,N]=s.useState(null),[T,L]=s.useState(null),[k,u]=s.useState(""),[C,D]=s.useState("ARS"),[p,F]=s.useState(""),[S,O]=s.useState([]),[R,z]=s.useState(""),[E,U]=s.useState({method:"transferencia",terms:"Transferencia bancaria",methods:["transferencia"]}),[B,V]=s.useState(""),[M,Q]=s.useState(!1),[H,J]=s.useState(""),[r,d]=s.useState(""),[g,b]=s.useState("remito"),[A,_]=s.useState("con"),[j,i]=s.useState(""),[c,x]=s.useState(""),P=s.useRef(null),I=s.useRef(null);s.useEffect(()=>{(async()=>{try{const{Autocomplete:w}=await window.google.maps.importLibrary("places"),$={componentRestrictions:{country:"ar"},fields:["address_components","geometry","icon","name","formatted_address","place_id"],types:["geocode"]};if(P.current){const q=new w(P.current,$);q.addListener("place_changed",()=>{const y=q.getPlace();y.geometry&&y.geometry.location&&y.formatted_address&&y.place_id&&(v({address:y.formatted_address,lat:y.geometry.location.lat(),lng:y.geometry.location.lng(),placeId:y.place_id}),x(""),setTimeout(calcDistance,0))})}if(I.current){const q=new w(I.current,$);q.addListener("place_changed",()=>{const y=q.getPlace();y.geometry&&y.geometry.location&&y.formatted_address&&y.place_id&&(N({address:y.formatted_address,lat:y.geometry.location.lat(),lng:y.geometry.location.lng(),placeId:y.place_id}),x(""),setTimeout(calcDistance,0))})}}catch{x("No se pudo cargar el servicio de autocompletado de direcciones.")}})()},[]);const Z=n=>{const w=n,$=[n],q=w==="transferencia"?"Transferencia bancaria":w==="efectivo"?"Pago en efectivo":`Cheque a ${B||"X"} días`;U({method:w,terms:q,methods:$,chequeDays:n==="cheque"?Number(B||0):void 0,splitOriginDestination:M,originPercent:Number(H||0),destinationPercent:Number(r||0)})};s.useEffect(()=>{E.method==="cheque"&&U(n=>({...n,terms:`Cheque a ${B||"X"} días`,chequeDays:Number(B||0)}))},[B,E.method]);const ce=n=>{if(n.preventDefault(),x(""),!t.trim()){x("El título es obligatorio.");return}if(!o||!m){x("Por favor, selecciona un origen y destino válidos de la lista de sugerencias.");return}if(!k){x("Debes especificar un precio para la carga.");return}const w=String(k);if(w.length>=4){const q=/^(\d)\1{3,}$/.test(w);let y=!0,re=!0;for(let G=1;G<w.length;G++){const ie=+w[G]-+w[G-1];ie!==1&&(y=!1),ie!==-1&&(re=!1)}if(q||y||re){x("El precio no puede contener secuencias numéricas consecutivas o repetidas.");return}}if(a.plan==="silver"&&(j===""||Number(j)<=0)){x("Debes especificar la cantidad de cupos para el plan Silver.");return}const $={companyId:a.id,driverId:null,status:ee.AVAILABLE,startLocation:o,endLocation:m,price:Number(k),currency:C,title:t.trim(),distanceKm:T||void 0,company:a.companyName||"Empresa Desconocida",cargoDetails:p,requirements:[],requiredTruckType:S,otherTruckType:S.includes("otro")&&R||void 0,paymentDetails:{...E,splitOriginDestination:M,originPercent:M?Number(H||0):void 0,destinationPercent:M?Number(r||0):void 0},billing:{type:g,iva:g==="factura"?A:void 0},slots:a.plan==="silver"?Number(j||0):void 0};f($)};return e.jsxs("div",{className:"max-w-2xl mx-auto p-8 bg-gray-800 rounded-lg shadow-lg mt-8",children:[e.jsx("button",{onClick:h,className:"text-blue-400 hover:underline mb-6",children:"← Volver"}),e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Publicar Nueva Carga"}),e.jsxs("form",{onSubmit:ce,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-400 mb-2",children:"Título de la Carga"}),e.jsx("input",{id:"title",type:"text",value:t,onChange:n=>l(n.target.value),required:!0,className:"w-full p-3 bg-gray-700 rounded-md",placeholder:"Ejemplo: Carga de madera a Rosario"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startLocation",className:"block text-sm font-medium text-gray-400 mb-2",children:"Dirección de Origen"}),e.jsx("input",{id:"startLocation",ref:P,type:"text",placeholder:"Comienza a escribir la dirección...",required:!0,className:"w-full p-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-[#F57921]"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endLocation",className:"block text-sm font-medium text-gray-400 mb-2",children:"Dirección de Destino"}),e.jsx("input",{id:"endLocation",ref:I,type:"text",placeholder:"Comienza a escribir la dirección...",required:!0,className:"w-full p-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-[#F57921]"})]}),T!=null&&e.jsxs("div",{className:"text-sm text-blue-300",children:[e.jsx("i",{className:"fas fa-route mr-2"}),"Distancia estimada: ",Math.round(T)," km"]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-400 mb-2",children:"Precio Ofrecido"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:C,onChange:n=>D(n.target.value),className:"p-3 bg-gray-700 rounded-md",children:[e.jsx("option",{value:"ARS",children:"ARS"}),e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"BRL",children:"BRL"})]}),e.jsx("input",{id:"price",type:"number",placeholder:"Ej: 2000000",value:k,onChange:n=>u(n.target.value===""?"":Number(n.target.value)),required:!0,className:"flex-1 p-3 bg-gray-700 rounded-md"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cargoDetails",className:"block text-sm font-medium text-gray-400 mb-2",children:"Detalles de la Carga"}),e.jsx("textarea",{id:"cargoDetails",placeholder:"Ej: 24 pallets, 15 toneladas, mercadería general",value:p,onChange:n=>F(n.target.value),required:!0,className:"w-full p-3 bg-gray-700 rounded-md h-24"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Método y Términos de Pago"}),e.jsx("div",{className:"flex gap-2 mb-2",children:["transferencia","efectivo","cheque"].map(n=>e.jsx("button",{type:"button",onClick:()=>Z(n),className:`flex-1 p-2 rounded-md font-semibold text-center transition ${E.method===n?"bg-[#00529B] text-white":"bg-gray-700 text-gray-300"}`,children:n.charAt(0).toUpperCase()+n.slice(1)},n))}),E.method==="cheque"&&e.jsx("input",{type:"text",placeholder:"Días del cheque (ej: 30, 60, 90)",value:B,onChange:n=>V(n.target.value),className:"w-full p-3 mt-2 bg-gray-700 rounded-md"}),e.jsx("input",{type:"text",placeholder:"Términos",value:E.terms,onChange:n=>U(w=>({...w,terms:n.target.value})),className:"w-full p-3 mt-2 bg-gray-700 rounded-md"}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:n=>Q(n.target.checked)})," Pago parte en origen y parte en destino"]}),M&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2",children:[e.jsx("input",{type:"number",placeholder:"% Origen",value:H,onChange:n=>J(n.target.value===""?"":Number(n.target.value)),className:"p-3 bg-gray-700 rounded-md"}),e.jsx("input",{type:"number",placeholder:"% Destino",value:r,onChange:n=>d(n.target.value===""?"":Number(n.target.value)),className:"p-3 bg-gray-700 rounded-md"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Tipo de Camión Requerido"}),e.jsx("select",{multiple:!0,value:S,onChange:n=>O(Array.from(n.target.selectedOptions,w=>w.value)),className:"w-full p-3 bg-gray-700 rounded-md h-32",children:de.map(n=>e.jsx("option",{value:n,children:n.charAt(0).toUpperCase()+n.slice(1)},n))}),S.includes("otro")&&e.jsx("input",{type:"text",placeholder:"Describe el camión",value:R,onChange:n=>z(n.target.value),className:"w-full p-3 mt-2 bg-gray-700 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Remito o Factura"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"billingType",checked:g==="remito",onChange:()=>b("remito")})," Remito"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"billingType",checked:g==="factura",onChange:()=>b("factura")})," Factura"]}),g==="factura"&&e.jsxs("div",{className:"flex gap-3 ml-4",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"iva",checked:A==="con",onChange:()=>_("con")})," Con IVA"]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"iva",checked:A==="sin",onChange:()=>_("sin")})," Sin IVA"]})]})]})]}),a.plan==="silver"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Cupos (viajes posibles)"}),e.jsx("input",{type:"number",value:j,onChange:n=>i(n.target.value===""?"":Number(n.target.value)),className:"w-full p-3 bg-gray-700 rounded-md",required:!0})]}),c&&e.jsx("p",{className:"text-red-400 bg-red-900/50 p-3 rounded-md text-center",children:c}),e.jsx("button",{type:"submit",className:"w-full bg-[#F57921] text-white font-bold py-3 rounded-md hover:bg-opacity-90 transition-all",children:"Publicar Carga"})]})]})},oe=a=>{const f=a.split(","),h=f[0].match(/:(.*?);/)[1],t=atob(f[1]);let l=t.length;const o=new Uint8Array(l);for(;l--;)o[l]=t.charCodeAt(l);return new Blob([o],{type:h})},Te=({user:a,onIdentitySubmitted:f,onLogout:h})=>{const[t,l]=s.useState("dniFront"),[o,v]=s.useState({}),[m,N]=s.useState({}),[T,L]=s.useState(""),[k,u]=s.useState(""),[C,D]=s.useState(!1),p=s.useRef(null),F=s.useRef(null),[S,O]=s.useState(null),R=r=>r==="selfie"?["Sosten el telefono en horizontal (paisaje).","Centra tu rostro dentro del ovalo, cabeza completa.","Quita gafas/visera; busca luz frontal y uniforme.","Evita contraluz y fondos con mucho brillo."]:r==="dniFront"||r==="dniBack"||r==="licenseFront"||r==="licenseBack"?["Alinea el DNI/licencia dentro del rectangulo punteado.","Evita reflejos; usa luz lateral suave.","Apoya el documento sobre fondo liso y oscuro.","Toca sobre el DNI para enfocar."]:[],z=s.useRef(null),[E,U]=s.useState({x:0,y:0,visible:!1}),B=s.useRef(null),V=s.useRef(null),M=async r=>{try{if(p.current){const d=await navigator.mediaDevices.getUserMedia({video:{facingMode:r}});p.current.srcObject=d,p.current.muted=!0,p.current.setAttribute("playsinline","true"),await p.current.play();try{const g=p.current.srcObject,b=g?.getVideoTracks?g.getVideoTracks()[0]:null;if(B.current=b,b?.getCapabilities)try{V.current=b.getCapabilities()}catch{V.current=null}b&&b.applyConstraints&&await b.applyConstraints({advanced:[{focusMode:"continuous"},{exposureMode:"continuous"},{whiteBalanceMode:"continuous"}]}).catch(()=>{})}catch{}}}catch{u("No se pudo acceder a la cámara. Revisa los permisos.")}};s.useEffect(()=>((async()=>{try{if(!S){const{startOrResumeAttempt:r}=await X(async()=>{const{startOrResumeAttempt:g}=await import("./verificationOrchestrator-aFobkJ0i.js");return{startOrResumeAttempt:g}},__vite__mapDeps([5,0,1,2,3,4])),d=await r(a.id);O(d.ref),setAttemptNumber(d.attemptNumber)}}catch{}})(),t==="dniFront"||t==="dniBack"||t==="licenseFront"||t==="licenseBack"?M("environment"):t==="selfie"&&M("user"),()=>{p.current&&p.current.srcObject&&p.current.srcObject.getTracks().forEach(r=>r.stop())}),[t]);const Q=async()=>{if(!p.current||!F.current||!t)return;u(""),D(!0);const r=p.current,d=F.current;if(t==="selfie"&&!(r.videoWidth>=r.videoHeight)){u("Para la selfie, gira el tel�fono a horizontal y asegúrate de que la cabeza entre completa en el óvalo."),D(!1);return}d.width=r.videoWidth,d.height=r.videoHeight,d.getContext("2d")?.drawImage(r,0,0,r.videoWidth,r.videoHeight);const b=d.toDataURL("image/jpeg",.9).split(",")[1],A=await X(()=>import("./index-BK2eRnKF.js").then(i=>i.g),__vite__mapDeps([0,1,2,3,4])),{ready:_,feedback:j}=await A.analyzeImageForVerification(b,t);if(_){v(i=>({...i,[t]:b}));try{if(S){const i=oe(`data:image/jpeg;base64,${b}`),c=t==="dniFront"?"dni_front":t==="dniBack"?"dni_back":t==="licenseFront"?"license_front":t==="licenseBack"?"license_back":"selfie",x=ae(te,`verifications/${a.id}/${S.id}/${c}.jpg`);await se(x,i);const P=await ne(x);N(Z=>({...Z,[t]:P}));const I={updatedAt:K()};t==="dniFront"&&(I.dniFrontUri=P),t==="dniBack"&&(I.dniBackUri=P),t==="licenseFront"&&(I.licenseFrontUri=P),t==="licenseBack"&&(I.licenseBackUri=P),t==="selfie"&&(I.selfieUri=P),await me(S,I)}}catch{}switch(t){case"dniFront":l("dniBack");break;case"dniBack":l(a.role===Y.DRIVER?"licenseFront":"selfie");break;case"licenseFront":l("licenseBack");break;case"licenseBack":l("selfie");break;case"selfie":l(null);break}}else u(j);D(!1)},H=async()=>{if(!o.dniFront||!o.dniBack||!o.selfie){u("Faltan fotos. Captura frente, dorso y selfie.");return}D(!0),u("Enviando documentaci�n para verificaci�n...");let r=S;if(!r){const i=pe(ue,"identity_verification_logs",a.id,"attempts"),c=await xe(i),x=(c?.size||c?.docs?.length||0)+1,P=x===1?"gemini":x<=3?"google_cloud":"staff";r=fe(i),await le(r,{attemptId:r.id,attemptNumber:x,engine:P,status:"pending",attemptStatus:"pending",components:{},createdAt:K(),updatedAt:K()}),O(r)}const d=async(i,c,x)=>{if(i)return i;const P=oe(`data:image/jpeg;base64,${c}`),I=ae(te,`verifications/${a.id}/${r.id}/${x}.jpg`);return await se(I,P),ne(I)},g=await d(m.dniFront,o.dniFront,"dni_front"),b=await d(m.dniBack,o.dniBack,"dni_back"),A=o.licenseFront?await d(m.licenseFront,o.licenseFront,"license_front"):m.licenseFront||"",_=o.licenseBack?await d(m.licenseBack,o.licenseBack,"license_back"):m.licenseBack||"",j=await d(m.selfie,o.selfie,"selfie");await le(r,{attemptId:r.id,userSubmittedDni:T||null,dniFrontUri:g,dniBackUri:b,licenseFrontUri:A,licenseBackUri:_,selfieUri:j,updatedAt:K(),finalState:"pendiente_manual"},{merge:!0});try{const{finalizeAttemptAndRoute:i}=await X(async()=>{const{finalizeAttemptAndRoute:c}=await import("./verificationOrchestrator-aFobkJ0i.js");return{finalizeAttemptAndRoute:c}},__vite__mapDeps([5,0,1,2,3,4]));await i({uid:a.id,attemptRef:r,attemptNumber,selfieUri:j,dniFrontUri:g,dniBackUri:b,licenseFrontUri:A,licenseBackUri:_,dniNumber:T})}catch{}f(T,"pending_review"),D(!1)},J={dniFront:"Frente del Documento",dniBack:"Dorso del Documento",licenseFront:"Licencia (Frente)",licenseBack:"Licencia (Dorso)",selfie:"Tómate una Selfie"};return e.jsxs("div",{className:"max-w-lg mx-auto p-6 bg-gray-800 rounded-lg shadow-xl mt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Verificación de Identidad"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Para tu seguridad, necesitamos verificar tu identidad. Este proceso solo toma un minuto."}),t?e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold mb-2 text-blue-400",children:J[t]}),e.jsx("div",{className:"mb-3 text-xs text-gray-200 bg-gray-700/60 p-2 rounded",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:R(t).map((r,d)=>e.jsx("li",{children:r},d))})}),e.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden aspect-video",children:[e.jsx("video",{ref:p,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsxs("div",{ref:z,onClick:r=>{if(!p.current||!z.current)return;const d=z.current.getBoundingClientRect(),g=r.clientX-d.left,b=r.clientY-d.top,A=Math.max(0,Math.min(1,g/d.width)),_=Math.max(0,Math.min(1,b/d.height)),j=B.current,i=V.current||{};j&&j.applyConstraints&&(async()=>{try{if(i.pointsOfInterest)await j.applyConstraints({advanced:[{pointsOfInterest:[{x:A,y:_}]}]});else if(Array.isArray(i.focusMode)&&i.focusMode.includes("single-shot"))await j.applyConstraints({advanced:[{focusMode:"single-shot"}]});else if(i.focusDistance&&typeof i.focusDistance.min=="number"){const c=(i.focusDistance.min+i.focusDistance.max)/2;await j.applyConstraints({advanced:[{focusMode:"manual",focusDistance:c}]})}else if(i.zoom&&typeof i.zoom.min=="number"){const c=i.zoom.min+(i.zoom.max-i.zoom.min)*.5;await j.applyConstraints({advanced:[{zoom:c}]})}}catch{}})(),U({x:g,y:b,visible:!0}),setTimeout(()=>U(c=>({...c,visible:!1})),800)},onTouchStart:r=>{if(!z.current||!p.current)return;const d=r.touches[0],g=z.current.getBoundingClientRect(),b=d.clientX-g.left,A=d.clientY-g.top,_=Math.max(0,Math.min(1,b/g.width)),j=Math.max(0,Math.min(1,A/g.height)),i=B.current,c=V.current||{};i&&i.applyConstraints&&(async()=>{try{if(c.pointsOfInterest)await i.applyConstraints({advanced:[{pointsOfInterest:[{x:_,y:j}]}]});else if(Array.isArray(c.focusMode)&&c.focusMode.includes("single-shot"))await i.applyConstraints({advanced:[{focusMode:"single-shot"}]});else if(c.focusDistance&&typeof c.focusDistance.min=="number"){const x=(c.focusDistance.min+c.focusDistance.max)/2;await i.applyConstraints({advanced:[{focusMode:"manual",focusDistance:x}]})}else if(c.zoom&&typeof c.zoom.min=="number"){const x=c.zoom.min+(c.zoom.max-c.zoom.min)*.5;await i.applyConstraints({advanced:[{zoom:x}]})}}catch{}})(),U({x:b,y:A,visible:!0}),setTimeout(()=>U(x=>({...x,visible:!1})),800)},className:"absolute inset-0 border-4 border-dashed border-gray-500 rounded-lg cursor-crosshair",children:[(t==="dniFront"||t==="dniBack"||t==="licenseFront"||t==="licenseBack")&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"border-2 border-dashed border-green-400 rounded-md",style:{width:"80%",aspectRatio:"1.586"}})}),t==="selfie"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"border-2 border-dashed border-green-400 rounded-full",style:{width:"80%",height:"65%"}})}),E.visible&&e.jsx("span",{style:{left:E.x-20,top:E.y-20},className:"absolute w-10 h-10 rounded-full border-2 border-[#F57921] pointer-events-none animate-ping"}),e.jsx("span",{className:"absolute bottom-2 right-2 text-[10px] bg-black/60 text-gray-200 px-2 py-1 rounded",children:"Toca para enfocar"})]})]}),e.jsx("canvas",{ref:F,className:"hidden"}),e.jsx("button",{onClick:Q,disabled:C,className:"w-full mt-4 bg-[#00529B] text-white font-bold py-3 rounded-md hover:bg-opacity-90 disabled:opacity-50",children:C?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-camera mr-2"}),"Capturar"]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-blue-400",children:"Último Paso"}),e.jsx("p",{children:"Por favor, ingresa tu número de documento para la verificación final."}),e.jsx("input",{type:"text",placeholder:"Número de Documento",value:T,onChange:r=>L(r.target.value),className:"w-full p-3 bg-gray-700 rounded-md"}),e.jsx("button",{onClick:H,disabled:C,className:"w-full bg-[#F57921] text-white font-bold py-3 rounded-md hover:bg-opacity-90 disabled:opacity-50",children:C?e.jsx("i",{className:"fas fa-spinner fa-spin"}):"Enviar para Verificación"})]}),k&&e.jsx("p",{className:"mt-4 text-center text-yellow-300 bg-yellow-900/50 p-3 rounded-md",children:k}),e.jsx("button",{onClick:h,className:"text-gray-500 hover:text-red-400 mt-8 text-sm mx-auto block",children:"Cerrar sesión"})]})};export{Ce as LoadDetailsPage,ke as PendingVerificationPage,Ne as PlansPage,Re as PostLoadPage,we as VerifyAccountPage,Te as VerifyIdPage};
